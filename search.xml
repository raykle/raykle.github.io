<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[iOS Universal Links]]></title>
      <url>http://raykle.coding.me/2017/04/16/iOS-Universal-Links/</url>
      <content type="html"><![CDATA[<h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>iOS 9 ä»¥å‰ï¼Œä»å¤–éƒ¨å¯åŠ¨ App éƒ½æ˜¯é€šè¿‡ <code>URL Scheme</code> å®ç°è·³è½¬çš„ã€‚è¿™ç§æ–¹å¼è™½ç„¶å¯è‡ªå®šç¨‹åº¦å¾ˆé«˜ï¼Œèƒ½å¤Ÿå·§å¦™åœ°å®ç°å¾ˆå¤šè·³è½¬ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨å¾ˆå¤šå¼Šç«¯ã€‚</p>
<p>åœ¨ 2015 å¹´è‹¹æœ WWDC ä¸Šï¼Œè‹¹æœå®£å¸ƒäº† <code>Universal Links</code> è¿™é¡¹æ–°æŠ€æœ¯ï¼Œå®ç°äº†åœ¨ iOS 9 åŠä¹‹åçš„ç³»ç»Ÿä¸Šï¼Œåœ¨åªåšå°‘é‡é¢å¤–å¼€å‘çš„æ¡ä»¶ä¸‹ï¼Œä¸åŒ App ä¹‹é—´èƒ½å¤Ÿç›´æ¥ã€é¡ºç•…ã€æ— ç¼è¡”æ¥çš„è·³è½¬ï¼Œè®©ç”¨æˆ·ä½“éªŒåˆæå‡äº†ä¸€ä¸ªçº§åˆ«ã€‚</p>
<hr>
<a id="more"></a>
<h2 id="URL-Scheme-VS-Universal-Links"><a href="#URL-Scheme-VS-Universal-Links" class="headerlink" title="URL Scheme  VS  Universal Links"></a>URL Scheme  VS  Universal Links</h2><h3 id="URL-schemes"><a href="#URL-schemes" class="headerlink" title="URL schemes"></a>URL schemes</h3><p>éå¸¸æœ‰æ•ˆï¼Œèƒ½å¤Ÿè®© app ä¹‹é—´å½¼æ­¤äº¤æµï¼Œä¼ é€’æ•°æ®ã€‚</p>
<h4 id="ç¼ºé™·"><a href="#ç¼ºé™·" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h4><ul>
<li>éœ€è¦æå‰åŠ å…¥åˆ°ç™½åå•ï¼Œä¸”ä¼šè¯¢é—®ç”¨æˆ·â€œæ˜¯å¦æ‰“å¼€â€˜xxxâ€™åº”ç”¨â€ã€‚</li>
<li>ä¸ä¼šæ€»èƒ½æ˜ å°„åˆ°æ­£ç¡®çš„ appï¼Œä¸¤ä¸ª app å¯èƒ½æ‹¥æœ‰åŒæ ·çš„ schemeï¼Œè€Œå¼€å‘è€…ä¸èƒ½æ˜ç¡®åœ°è¡¨ç¤ºä»–ä»¬æŒ‡çš„æ˜¯é‚£ä¸ª appã€‚</li>
<li>app æ²¡æœ‰å®‰è£…çš„æ—¶å€™ä¸èƒ½å·¥ä½œã€‚</li>
<li>ä¸èƒ½æœ‰æ•ˆåœ°ä¿æŠ¤ç”¨æˆ·éšç§ã€‚app éœ€è¦æŸ¥æ˜æ˜¯å¦å·²ç»è¢«å®‰è£…åœ¨è®¾å¤‡ä¸Šï¼Œè¿™æ„å‘³ç€å®ƒå¯ä»¥å—…æ¢å‡ºç”¨æˆ·æ˜¯å¦å®‰è£…äº†æŸäº› appï¼Œè€Œè¿™æœ¬åº”å±äºç”¨æˆ·çš„ä¸ªäººä¿¡æ¯ã€‚</li>
</ul>
<hr>
<h3 id="Universal-Links"><a href="#Universal-Links" class="headerlink" title="Universal Links"></a>Universal Links</h3><p>Universal Links æ˜¯è‹¹æœåœ¨ 2015 å¹´ WWDC ä¸Šæ¨å‡ºçš„ä¸€é¡¹æ–°åŠŸèƒ½ï¼Œå®˜æ–¹åŠŸèƒ½æè¿°å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>In iOS 9 and later, universal links let users open your app when they tap links to your website within WKWebView and UIWebView views and Safari pages, in addition to links that result in a call to openURL:, such as those that occur in Mail, Messages, and other apps.</p>
</blockquote>
<p>å³å½“ç”¨æˆ·åœ¨ WKWebViewã€UIWebView æˆ–è€… Safari ä¸­ç‚¹å‡»ä¸€ä¸ªé“¾æ¥ï¼Œå¦‚æœè®¾å¤‡ä¸Šå®‰è£…äº†é€‚é…è¯¥é“¾æ¥çš„ appï¼Œå°±å¯ä»¥è·³è½¬è¯¥ app å¯¹åº”çš„é¡µé¢ï¼Œå¦åˆ™ä»ç„¶å±•ç¤ºç½‘é¡µ ã€‚<br>ç”±äºç›®å‰å¾®ä¿¡å†…ç½®æµè§ˆå™¨ä¸æ”¯æŒ openURL çš„æ–¹å¼è¿›è¡Œåº”ç”¨é—´çš„è·³è½¬ï¼Œä¸å°‘ app éƒ½æ˜¯é€šè¿‡æ¥å…¥ Universal Links å®ç°å¾®ä¿¡æµè§ˆå™¨ä¸€é”®è·³è½¬åˆ°è‡ªå·± app çš„åŠŸèƒ½ï¼Œæ¯”å¦‚ç½‘æ˜“æ–°é—»ï¼ŒçŸ¥ä¹ç­‰ã€‚</p>
<h4 id="ä¼˜ç‚¹"><a href="#ä¼˜ç‚¹" class="headerlink" title="ä¼˜ç‚¹"></a>ä¼˜ç‚¹</h4><p>ç›¸æ¯”äº Custom URL Schemeï¼Œå®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºäº†å‡ ä¸ªä¼˜ç‚¹ï¼š</p>
<ul>
<li><strong>Unique.</strong> Unlike custom URL schemes, universal links canâ€™t be claimed by other apps, because they use standard HTTP or HTTPS links to your website.</li>
<li><strong>Secure.</strong> When users install your app, iOS checks a file that youâ€™ve uploaded to your web server to make sure that your website allows your app to open URLs on its behalf. Only you can create and upload this file, so the association of your website with your app is secure.</li>
<li><strong>Flexible.</strong> Universal links work even when your app is not installed. When your app isnâ€™t installed, tapping a link to your website opens the content in Safari, as users expect.</li>
<li><strong>Simple.</strong> One URL works for both your website and your app.</li>
<li><strong>Private.</strong> Other apps can communicate with your app without needing to know whether your app is installed.</li>
</ul>
<p>å³ï¼š</p>
<ul>
<li><strong>ç‹¬ç‰¹æ€§</strong> ä¸è‡ªå®šä¹‰çš„URLé“¾æ¥ç›¸æ¯”,é€šç”¨é“¾æ¥ä¸èƒ½è¢«å…¶ä»–çš„åº”ç”¨ç¨‹åºæ‰€è®¿é—®ï¼Œå› ä¸ºå®ƒä»¬ä½¿ç”¨æ ‡å‡†çš„ HTTP æˆ– HTTPS é“¾æ¥åˆ°æ‚¨çš„ç½‘ç«™ã€‚</li>
<li><strong>å®‰å…¨æ€§</strong> å½“ç”¨æˆ·å®‰è£…æ‚¨çš„åº”ç”¨ç¨‹åºæ—¶ï¼ŒiOS ä¼šæ£€æŸ¥æ‚¨å·²ä¸Šä¼ åˆ° Web æœåŠ¡å™¨çš„æ–‡ä»¶ï¼Œä»¥ç¡®ä¿æ‚¨çš„ç½‘ç«™å…è®¸æ‚¨çš„ app ä»£è¡¨å…¶æ‰“å¼€ URL (ç‚¹å‡»ä¸€ä¸ª URL é“¾æ¥æ—¶ï¼Œç›´æ¥æ‰“å¼€ç›¸åº” app)ã€‚ åªæœ‰æ‚¨å¯ä»¥åˆ›å»ºå’Œä¸Šä¼ æ­¤æ–‡ä»¶ï¼Œå› æ­¤æ‚¨çš„ç½‘ç«™ä¸æ‚¨çš„åº”ç”¨ç¨‹åºçš„å…³è”æ˜¯å®‰å…¨çš„ã€‚</li>
<li><strong>çµæ´»æ€§</strong> å³ä½¿æ²¡æœ‰å®‰è£… appï¼ŒUniversal links ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚ å½“æ²¡æœ‰å®‰è£… app æ—¶ï¼Œç‚¹å‡»ä¸€ä¸ªæŒ‡å‘æ‚¨ç½‘ç«™çš„é“¾æ¥ï¼Œä¼šæŒ‰ç…§ç”¨æˆ·çš„æœŸæœ›åœ¨ Safari ä¸­æ‰“å¼€ã€‚</li>
<li><strong>ç®€å•æ€§</strong> é€šç”¨é“¾æ¥åŒæ—¶é€‚ç”¨äºä½ çš„ç½‘ç«™å’Œ appã€‚</li>
<li><strong>ç§æœ‰æ€§</strong> å…¶ä»–åº”ç”¨ç¨‹åºå¯ä»¥ä¸æ‚¨çš„åº”ç”¨ç¨‹åºé€šä¿¡ï¼Œè€Œæ— éœ€çŸ¥é“æ‚¨çš„åº”ç”¨ç¨‹åºæ˜¯å¦å·²å®‰è£…ã€‚</li>
</ul>
<h4 id="ç¼ºé™·-1"><a href="#ç¼ºé™·-1" class="headerlink" title="ç¼ºé™·"></a>ç¼ºé™·</h4><ul>
<li>è‡³å°‘ iOS 9 ä»¥ä¸Šçš„ç³»ç»Ÿæ‰æ”¯æŒ ULã€‚</li>
</ul>
<hr>
<h2 id="UL-å¼€å‘æµç¨‹"><a href="#UL-å¼€å‘æµç¨‹" class="headerlink" title="UL å¼€å‘æµç¨‹"></a>UL å¼€å‘æµç¨‹</h2><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><ul>
<li>ä¸€ä¸ª HTTPS çš„åå°åŸŸå</li>
<li>å¯ä»¥ä¸Šä¼ ä¸€ä¸ª JSON æ–‡ä»¶åˆ°æœåŠ¡å™¨çš„æƒé™</li>
<li>iOS 9 at least</li>
<li>Xcode 7 at least</li>
</ul>
<h3 id="iOS-ç«¯"><a href="#iOS-ç«¯" class="headerlink" title="iOS ç«¯"></a>iOS ç«¯</h3><h4 id="1-æ·»åŠ -Associated-Domain"><a href="#1-æ·»åŠ -Associated-Domain" class="headerlink" title="1. æ·»åŠ  Associated Domain"></a>1. æ·»åŠ  Associated Domain</h4><p>åœ¨å¼€å‘è€…ç½‘ç«™æ‰¾åˆ°æƒ³è¦å¼€å¯ UL çš„ App IDï¼ˆ<code>Account -&gt; Certificates, Identifiers &amp; Profiles -&gt; App IDs -&gt; YourAppId</code>ï¼‰ï¼Œç‚¹å‡» <code>Edit</code> è¿›å…¥ç¼–è¾‘é¡µé¢ï¼Œæ‰¾åˆ° <code>Associated Domains</code> å°†å¯¹åº”çš„å¤é€‰æ¡†é€‰ä¸­ï¼Œç„¶åç‚¹å‡» <code>Done</code> å°±å¯ä»¥äº†ã€‚</p>
<p><img src="media/790890-40795a68e8fe351f.jpg" alt="Associated Domains in developer.apple.com"></p>
<blockquote>
<p>å¦‚æœæœ‰å¯¹åº”çš„ <code>Provision Profiles</code>ï¼Œè®°å¾—ç‚¹å‡» <code>Edit</code>ï¼Œé‡æ–° <code>Generate</code>ï¼Œå¹¶ <code>Download</code> æ›´æ–°åˆ° <code>Xcode</code> ä¸­ã€‚</p>
</blockquote>
<p>ç„¶åï¼Œåœ¨ <code>Xcode</code> ä¸­ï¼Œ<code>TARGETS -&gt; YourTarget -&gt; Capabilities -&gt; Associated Domains</code>ï¼Œæ‰“å¼€æ­¤åŠŸèƒ½å¼€å…³ã€‚<br>ç‚¹å‡» <code>+</code> æ·»åŠ éœ€è¦æ”¯æŒè·³è½¬çš„ <code>domain</code>ï¼Œéœ€è¦ä»¥ <code>applinks:</code> ä¸ºå‰ç¼€ï¼›åŒæ—¶å¯ä»¥æ·»åŠ ä¸€äº›å­åŸŸåã€‚æ¯”å¦‚ï¼š<code>applinks:www.example.com</code>ï¼Œ<code>applinks:news.example.com</code> ç­‰ã€‚</p>
<p><img src="media/14920951359976.jpg" alt="Associated Domains in Xcode"></p>
<p><strong><em>Tips:</em></strong><br>åšå®Œä¸Šé¢è¿™äº›æ­¥éª¤ï¼Œä½ çš„ app å°†èƒ½å¤Ÿä»ä½ æŒ‡å®šçš„è¿™äº›åŸŸåè¯·æ±‚ä¸€ä¸ªç‰¹æ®Šçš„ <code>JSON</code> æ–‡ä»¶ï¼š<code>apple-app-site-association</code>ã€‚å½“ä½  <strong>ç¬¬ä¸€æ¬¡å®‰è£…ï¼Œæˆ–è€…ç‰ˆæœ¬æ›´æ–°</strong> çš„æ—¶å€™ï¼Œè®¾å¤‡å°†ä»æŒ‡å®šçš„åŸŸåè¯·æ±‚æ–‡ä»¶ï¼š<code>https://www.example.com/.well-known/apple-app-site-association</code>ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä¼šè¯·æ±‚ï¼š<code>https://www.example.com/apple-app-site-association</code>ã€‚</p>
<h4 id="2-åˆ›å»º-apple-app-site-association-æ–‡ä»¶"><a href="#2-åˆ›å»º-apple-app-site-association-æ–‡ä»¶" class="headerlink" title="2. åˆ›å»º apple-app-site-association æ–‡ä»¶"></a>2. åˆ›å»º apple-app-site-association æ–‡ä»¶</h4><p>æ ¼å¼åŠå†…å®¹å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "applinks" : &#123;</span><br><span class="line">    "apps" : [],</span><br><span class="line">    "details" : [</span><br><span class="line">      //å¦‚æœæœ‰ä¸æ­¢ä¸€ä¸ª appï¼Œæˆ–è€… app æœ‰å¤šç§ç¯å¢ƒï¼ˆæ¯”å¦‚ï¼šdevï¼Œproï¼‰ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ•°ç»„ä¸­æ·»åŠ å¤šä¸ªå…ƒç´ ã€‚</span><br><span class="line">      &#123;</span><br><span class="line">        //appID: App Prefix(Team ID) + Bundle ID</span><br><span class="line">        "appID" : "ABCDE12345.com.apple.wwdc",</span><br><span class="line">        "paths" : [</span><br><span class="line">          //è·¯å¾„æ•°ç»„ï¼šå‘ŠçŸ¥æˆ‘ä»¬ ç½‘ç«™çš„å“ªéƒ¨åˆ†å¯ä»¥é€šè¿‡ app æ”¯æŒã€‚</span><br><span class="line">          //å¦‚æœæ•´ä¸ªç½‘ç«™éƒ½å¯ä»¥é€šè¿‡ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `*`ã€‚</span><br><span class="line">          "*", //å…¨éƒ¨ç½‘ç«™éƒ½æ”¯æŒ</span><br><span class="line">          "/wwdc/news/", //`å®Œå…¨åŒ¹é…`</span><br><span class="line">          "/videos/wwdc/2015/*" // `è·¯å¾„å‰ç¼€`</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        "appID" : "HIJKL67890.com.apple.wwdc",</span><br><span class="line">        "paths" : [</span><br><span class="line">          //"?" è¡¨ç¤ºæ›¿æ¢è·¯å¾„ä¸­çš„ä¸€ä¸ªå­—ç¬¦</span><br><span class="line">          "/foo/*/bar/201?/mypage",</span><br><span class="line">          // æ”¯æŒä½¿ç”¨ `NOT` å…³é”®å­—ï¼ŒæŒ‡å®šä¸ä½œä¸ºé€šç”¨é“¾æ¥å¤„ç†çš„åŒºåŸŸ</span><br><span class="line">          "NOT /path/to/exclude"</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>æ³¨æ„ï¼š</strong><br><code>appID</code> ç”±å¼€å‘è€…è´¦å·çš„ <code>Team ID</code> å’Œ app çš„ <code>Bundle ID</code> æ„æˆã€‚<br><code>paths</code> æ˜¯<code>å¤§å°å†™æ•æ„Ÿ</code>çš„ï¼å…¶ä»– URL ç»„ä»¶æ¯”å¦‚ <code>query</code>ï¼Œ<code>fragment</code> åˆ™ä¸æ˜¯ã€‚</p>
<p>æ­¤æ–‡ä»¶åå¿…é¡»ä¸º <code>apple-app-site-association</code>ï¼Œä¸èƒ½æœ‰åç¼€ã€‚</p>
<p>å¿…é¡»ä¸ºæ¯ä¸€ä¸ªä½ çš„ app æ”¯æŒçš„æ‹¥æœ‰ç‹¬ç«‹å†…å®¹çš„ <code>domain</code> åˆ›å»ºå•ç‹¬çš„ <code>apple-app-site-association</code> æ–‡ä»¶ï¼Œæ¯”å¦‚ <code>apple.com</code> å’Œ <code>developer.apple.com</code>ï¼Œéœ€è¦å•ç‹¬çš„ <code>apple-app-site-association</code> æ–‡ä»¶ï¼Œå› ä¸ºè¿™äº›åŸŸåæä¾›ä¸åŒçš„æœåŠ¡ã€‚</p>
</blockquote>
<h4 id="3-iOS-å®ç°ä»£ç "><a href="#3-iOS-å®ç°ä»£ç " class="headerlink" title="3. iOS å®ç°ä»£ç "></a>3. iOS å®ç°ä»£ç </h4><p>åœ¨ <code>AppDelegate.m</code> ä¸­å®ç°å¦‚ä¸‹æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// https://developer.apple.com/videos/play/wwdc2015/509/</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application continueUserActivity:(<span class="built_in">NSUserActivity</span> *)userActivity restorationHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSArray</span> * _Nullable))restorationHandler &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> ([userActivity.activityType isEqualToString:<span class="built_in">NSUserActivityTypeBrowsingWeb</span>]) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="built_in">NSURL</span> *webUrl = userActivity.webpageURL;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (![<span class="keyword">self</span> presentUrl:webUrl]) &#123;</span><br><span class="line">            <span class="comment">// å½“è·³è½¬åˆ° app ä¸èƒ½è·³è½¬åˆ°ç›¸åº”çš„ç•Œé¢æ—¶ï¼Œè‹¹æœå»ºè®®ä¼˜é›…åœ°è§£å†³è¿™ç§é”™è¯¯ï¼Œ</span></span><br><span class="line">            <span class="comment">// å³ï¼šä½¿ç”¨ Safari æ‰“å¼€è¯¥é“¾æ¥ï¼Œé¿å… app ä¸­å¯èƒ½å‡ºç°ç©ºç™½ç•Œé¢ç­‰å¼‚å¸¸æƒ…å†µã€‚</span></span><br><span class="line">            [[<span class="built_in">UIApplication</span> sharedApplication] openURL:webUrl];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)presentUrl:(<span class="built_in">NSURL</span> *)url &#123;</span><br><span class="line">    <span class="built_in">NSURLComponents</span> *urlComponents = [<span class="built_in">NSURLComponents</span> componentsWithURL:url resolvingAgainstBaseURL:<span class="literal">YES</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSString</span> *host = urlComponents.host;</span><br><span class="line">    <span class="built_in">NSArray</span> *pathComponent = urlComponents.path.pathComponents;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ­¤å¤„æ ¹æ®ä¸åŒçš„ä¸šåŠ¡éœ€æ±‚è¿›è¡Œåˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> ([host isEqualToString:<span class="string">@"www.example.com"</span>]) &#123;</span><br><span class="line">        <span class="keyword">if</span> (pathComponent.count &gt; <span class="number">4</span>) &#123;</span><br><span class="line">            <span class="comment">//<span class="doctag">TODO:</span> Do some router here.</span></span><br><span class="line">            <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="4-ä»è®¤å¯çš„è¯ä¹¦ç­¾å‘æœºæ„è·å–-SSL-è¯ä¹¦"><a href="#4-ä»è®¤å¯çš„è¯ä¹¦ç­¾å‘æœºæ„è·å–-SSL-è¯ä¹¦" class="headerlink" title="4. ä»è®¤å¯çš„è¯ä¹¦ç­¾å‘æœºæ„è·å– SSL è¯ä¹¦"></a>4. ä»è®¤å¯çš„è¯ä¹¦ç­¾å‘æœºæ„è·å– SSL è¯ä¹¦</h4><h4 id="5-ç­¾å-JSON-æ–‡ä»¶"><a href="#5-ç­¾å-JSON-æ–‡ä»¶" class="headerlink" title="5. ç­¾å JSON æ–‡ä»¶"></a>5. ç­¾å JSON æ–‡ä»¶</h4><p>ä½¿ç”¨ä¸Šä¸€æ­¥çš„ SSL è¯ä¹¦å¯¹ JSON æ–‡ä»¶è¿›è¡Œç­¾åã€‚éœ€è¦æ˜¯ç”¨ Mac ç»ˆç«¯çš„ <code>openssl smime</code> å‘½ä»¤ã€‚</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">openssl smime \</span><br><span class="line">  -sign \</span><br><span class="line">  -nodetach \</span><br><span class="line">  -<span class="keyword">in</span> <span class="string">"unsigned.json"</span> \ <span class="comment"># JSON file æ–‡ä»¶åï¼ˆæœªç­¾åçš„ JSON æ–‡ä»¶ï¼‰</span></span><br><span class="line">  -out <span class="string">"apple-app-site-association"</span> \ <span class="comment"># è¿™é‡Œçš„åç§°å¿…é¡»å®Œå…¨åŒ¹é…</span></span><br><span class="line">  -outform DER \</span><br><span class="line">  -inkey <span class="string">"private-key.pem"</span> \ <span class="comment"># è¯ä¹¦ç”ŸæˆæœŸé—´ç”Ÿæˆçš„ç§é’¥</span></span><br><span class="line">  -signer <span class="string">"certificate.pem"</span> <span class="comment"># è¯ä¹¦ç­¾å‘æœºæ„æä¾›çš„è¯ä¹¦</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>iOS 9 Beta 2 ç‰ˆæœ¬å¼€å§‹ï¼Œ<strong><em>ğŸ‘‰ ä¸å†éœ€è¦æ­¤ç­¾åæ­¥éª¤ ğŸ‘ˆ</em></strong>ï¼Œåªéœ€è¦ä¸Šä¼ æœªç­¾åè¿‡çš„ <code>apple-app-site-association</code> æ–‡ä»¶åˆ° <code>HTTPS</code> æœåŠ¡å™¨å³å¯ï¼ŒiOS ä¼šå¤„ç†å…¶ä½™å·¥ä½œã€‚</p>
</blockquote>
<hr>
<h3 id="Server-ç«¯"><a href="#Server-ç«¯" class="headerlink" title="Server ç«¯"></a>Server ç«¯</h3><blockquote>
<p>Upload it to the root of your HTTPS web server. The file needs to be accessible via HTTPSâ€”without any redirectsâ€”at <a href="https:///apple-app-site-association" target="_blank" rel="external">https:///apple-app-site-association</a>. Next, you need to handle universal links in your app.</p>
</blockquote>
<p>å°† <code>apple-app-site-association</code> æ–‡ä»¶å­˜æ”¾åœ¨æœåŠ¡å™¨è·Ÿç›®å½•ï¼Œæˆ–è€…æ ¹ç›®å½•çš„ <code>.well-known</code> ç›®å½•ä¸‹ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.example.com/.well-known/apple-app-site-association</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å»ºè®®å­˜æ”¾äº <code>.well-known</code> ç›®å½•ä¸‹ï¼Œä»¥å‡å°‘è®¿é—®æ¬¡æ•°ï¼Œå› ä¸ºè®¾å¤‡ä¼šä¼˜å…ˆè¯·æ±‚ <code>.well-known</code> ç›®å½•ï¼Œå¦‚æœæ²¡æœ‰ï¼Œæ‰ä¼šå»æ ¹ç›®å½•ä¸‹è¯·æ±‚ã€‚</p>
<p><strong><em>æ³¨æ„ï¼š</em></strong><br><code>apple-app-site-association</code> æ–‡ä»¶çš„è®¿é—®å¿…é¡»ä¸æ”¯æŒé‡å®šå‘ã€‚<br>æœåŠ¡å™¨ä¸Š <code>apple-app-site-association</code> çš„æ›´æ–°ä¸ä¼šè®© iOS æœ¬åœ°çš„ <code>apple-app-site-association</code> åŒæ­¥æ›´æ–°ï¼Œå³ iOS åªä¼šåœ¨ App ç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶è¯·æ±‚ä¸€æ¬¡ï¼Œä»¥åé™¤é App æ›´æ–°æˆ–é‡æ–°å®‰è£…å¦åˆ™ä¸ä¼šåœ¨æ¯æ¬¡æ‰“å¼€æ—¶è¯·æ±‚ <code>apple-app-site-association</code>ã€‚</p>
</blockquote>
<hr>
<h3 id="å‰ç«¯"><a href="#å‰ç«¯" class="headerlink" title="å‰ç«¯"></a>å‰ç«¯</h3><h4 id="Smart-App-Banner"><a href="#Smart-App-Banner" class="headerlink" title="Smart App Banner"></a>Smart App Banner</h4><h5 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h5><p><code>Smart App Banner</code> æ˜¯åœ¨ <code>Safari</code> ä¸­æµ®åŠ¨åœ¨é¡µé¢é¡¶ç«¯çš„ä¸€ä¸ª <code>Banner</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¯¹ç½‘é¡µæ— ä¾µå…¥çš„ UI å…ƒç´ ï¼Œå¯ä»¥åœ¨ <code>Safari</code> è‡ªåŠ¨å‘ˆç°ã€‚</p>
<p>å¦‚æœç”¨æˆ·æœªå®‰è£… appï¼Œç‚¹å‡»è‡ªåŠ¨è·³è½¬åˆ° App Store çš„ä¸‹è½½é¡µã€‚å¦‚æœå·²å®‰è£…ï¼Œåˆ™ä¼šè‡ªåŠ¨å¯åŠ¨ç›¸åº”çš„ appã€‚</p>
<p><img src="media/IMG_1036.PNG" alt="Smart App Banner in zhihu.com"></p>
<h5 id="è®©ç½‘é¡µæ”¯æŒ-Smart-App-Banner-çš„æ˜¾ç¤º"><a href="#è®©ç½‘é¡µæ”¯æŒ-Smart-App-Banner-çš„æ˜¾ç¤º" class="headerlink" title="è®©ç½‘é¡µæ”¯æŒ Smart App Banner çš„æ˜¾ç¤º"></a>è®©ç½‘é¡µæ”¯æŒ Smart App Banner çš„æ˜¾ç¤º</h5><p>åœ¨ç½‘ç«™çš„ <code>head</code> æ ‡ç­¾ä¸­æ·»åŠ ä¸€ä¸ª <code>meta</code> çš„æ ‡ç­¾ã€‚</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"apple-itunes-app"</span> <span class="attr">content</span>=<span class="string">"app-id=123456789, app-argument=https://developer.apple.com/wwdc/schedule, affiliate-data=optionalAffiliateData"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>name=&quot;apple-itunes-app&quot;</code> ä¼šå‘Šè¯‰ Safari ä½ æƒ³è¦æ˜¾ç¤º <code>Smart App Banner</code>ã€‚<br><code>content</code> åŒ…å« <code>app-id</code>ï¼Œ<code>app id</code> æ˜¯æ¯ä¸ª app åœ¨ <code>iTunesConnect</code> ç½‘ç«™åˆ›å»ºä¹‹åï¼Œè·å–åˆ°çš„ä¸€ä¸ª <code>id</code>ã€‚æ­¤å¤„çš„åŠŸèƒ½æ˜¯ï¼šSafari ä¼šé€šè¿‡æ­¤ <code>id</code> å‘ <code>App Store</code> æŠ“å– app çš„ä¿¡æ¯æ˜¾ç¤ºåœ¨ <code>Smart App Banner</code> ä¸­ï¼ŒåŒ…æ‹¬ app åç§°ï¼Œå‚å•†ç­‰ã€‚å½“ç”¨æˆ·æ²¡æœ‰å®‰è£…ç›¸åº”çš„ app æ—¶ï¼Œç‚¹å‡»ä¹‹åä¼šæ ¹æ®æ­¤ <code>id</code> è·³è½¬åˆ° <code>App Store</code> è¿›å…¥ç›¸åº”çš„ä¸‹è½½é¡µã€‚<br><code>app-argument</code> å±æ€§åº”è¯¥åŒ…æ‹¬å½“å‰æ˜¾ç¤ºé¡µé¢çš„ <code>URL</code>ï¼Œæˆ–è€…è‡ªå®šä¹‰çš„ä¸€äº›å‚æ•°ç­‰ï¼Œå½“ç”¨æˆ·ç‚¹å‡» <code>Banner</code> æ‰“å¼€ appï¼Œæ­¤å‚æ•°å€¼ä¼šè¢«ä¼ é€’åˆ° iOS çš„<br><code>-application:continueUserActivity:restorationHandler:</code><br>æ–¹æ³•ä¸­ï¼Œé€šè¿‡ <code>userActivity.webpageURL</code> å¯ä»¥è·å–åˆ°ã€‚</p>
<p>å¯ä»¥é€šè¿‡æ‰’å–åˆ«äººçš„ç½‘é¡µä»£ç ï¼Œçœ‹çœ‹ä¸€äº›å…¶ä»–å¤§å…¬å¸çš„ä¾‹å­ã€‚<br>æ¯”å¦‚ï¼š</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//ç½‘æ˜“æ–°é—»</span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">â€‹</span>"<span class="attr">apple-itunes-app</span>" <span class="attr">content</span>=<span class="string">â€‹</span>"<span class="attr">app-id</span>=<span class="string">425349261,</span> <span class="attr">affiliate-data</span>=<span class="string">myAffiliateData,</span> <span class="attr">app-argument</span>=<span class="string">newsapp:â€‹/â€‹/â€‹doc/â€‹CHLFGFCB00097U7S?â€‹s</span>=<span class="string">sps_article</span>"&gt;</span>â€‹</span><br><span class="line"></span><br><span class="line">//çŸ¥ä¹ï¼š</span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">â€‹</span>"<span class="attr">apple-itunes-app</span>" <span class="attr">content</span>=<span class="string">â€‹</span>"<span class="attr">app-id</span>=<span class="string">432274380,</span> <span class="attr">app-argument</span>=<span class="string">zhihu:â€‹/â€‹/â€‹answers/â€‹154659733</span>" <span class="attr">data-react-helmet</span>=<span class="string">â€‹</span>"<span class="attr">true</span>"&gt;</span>â€‹</span><br><span class="line"></span><br><span class="line">//å¤šçœ‹</span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">â€‹</span>"<span class="attr">apple-itunes-app</span>" <span class="attr">content</span>=<span class="string">â€‹</span>"<span class="attr">app-id</span>=<span class="string">517850153,</span> <span class="attr">app-argument</span>=<span class="string">duokan-reader:â€‹/â€‹/â€‹store/â€‹book/â€‹09d88212e38611e18f0200163e0123ac</span>"&gt;</span>â€‹</span><br></pre></td></tr></table></figure>
<p><em>å¯ä»¥å…³æ³¨ä¸€ä¸‹ï¼Œè¿™äº›ä»£ç ä¸­ <code>app-argument</code> çš„å€¼çš„å†™æ³•ã€‚</em></p>
<p><code>Smart App Banner</code> åœ¨æ¨¡æ‹Ÿå™¨ä¸­ä¹Ÿä¼šå‡ºç°ï¼Œä½†æ˜¾ç¤ºçš„æ˜¯ä¸€ä¸ªç©ºç™½çš„ <code>Banner</code>ï¼Œapp åç§°ç­‰ä¿¡æ¯ä¸ä¼šæ˜¾ç¤ºã€‚</p>
<blockquote>
<p><em>æ¸©é¦¨æç¤ºï¼š</em><br>å¦‚æœä¸€ä¸ªç½‘ç«™çš„åŸŸåæ˜¯è¢« iOS å¼€å‘äººå‘˜é…ç½®åœ¨äº† <code>Associated Domains</code> ä¸­çš„ï¼Œä¸”åœ¨è¯¥åŸŸåä¸Šä¼ äº† <code>apple-app-site-association</code> çš„æ–‡ä»¶ï¼Œé‚£ä¹ˆå½“ä¸€å° iOS è®¾å¤‡å®‰è£…äº†ç›¸åº”çš„ app ä¹‹åï¼Œåœ¨ <code>Safari</code> æµè§ˆå™¨æ‰“å¼€è¯¥åŸŸåä¸‹çš„ç½‘å€ï¼Œåˆ™ä¼šè‡ªåŠ¨æ˜¾ç¤º <code>Smart App Banner</code>ï¼Œç½‘é¡µä¸ç”¨åšä»»ä½•é¢å¤–å¼€å‘ï¼ŒåŒ…æ‹¬æ·»åŠ  <code>meta</code> æ ‡ç­¾ã€‚ä½†æ˜¯è¿™ç§æƒ…å†µæœ‰ä¸€ä¸ª <strong>ç¼ºç‚¹</strong>ï¼Œå°±æ˜¯å¦‚æœæ²¡æœ‰å®‰è£…ç›¸åº”çš„ appï¼Œåˆ™ <code>Smart App Banner</code> ä¸ä¼šæ˜¾ç¤ºã€‚</p>
<p>å¦‚æœæƒ³è¦ <strong>æ—¶åˆ»æ˜¾ç¤º</strong> <code>Smart App Banner</code>ï¼Œåˆ™å‰ç«¯å¼€å‘äººå‘˜å¿…é¡»æ‰‹åŠ¨æ·»åŠ  <code>meta</code> æ ‡ç­¾ã€‚</p>
</blockquote>
<p>å½“å‰ç«¯å¼€å‘æ‰‹åŠ¨æ·»åŠ äº† <code>meata</code> æ ‡ç­¾ï¼Œåˆ™åœ¨ç½‘é¡µä¸­æ˜¾ç¤ºçš„ <code>banner</code> å·¦è¾¹ä¼šæœ‰ä¸€ä¸ª <code>X</code> æŒ‰é’®ï¼Œå…è®¸ç”¨æˆ·å…³é—­æ‰è¿™ä¸ª <code>banner</code>ï¼Œè€Œä¸€æ—¦ç”¨æˆ·å…³é—­äº†ï¼Œåˆ™åœ¨è¿™ä¸ªç½‘ç«™ä¸Šå°±ä¸ä¼šå†æ˜¾ç¤ºäº†ï¼Œå³ä¾¿é‡æ–°åŠ è½½ç½‘é¡µä¹Ÿä¸€æ ·ã€‚</p>
<p>ç›®å‰å”¯ä¸€èƒ½å¤Ÿè®© <code>Smart App Banner</code> å†æ¬¡æ˜¾ç¤ºçš„æ–¹æ³•å°±æ˜¯ <strong>è¿˜åŸæ‰€æœ‰è®¾ç½®</strong> ï¼ˆè®¾ç½® -&gt; é€šç”¨ -&gt; è¿˜åŸ -&gt; è¿˜åŸæ‰€æœ‰è®¾ç½®ï¼‰ã€‚å…·ä½“è¯·æŸ¥çœ‹ <a href="https://www.raywenderlich.com/80347/smart-app-banners-tutorial" target="_blank" rel="external">raywenderlich - Smart App Banners Tutorial</a> å’Œ <a href="https://developer.apple.com/library/content/documentation/AppleApplications/Reference/SafariWebContent/PromotingAppswithAppBanners/PromotingAppswithAppBanners.html" target="_blank" rel="external">Apple - Promoting Apps with Smart App Banners</a></p>
<h4 id="è‡ªå®šä¹‰é“¾æ¥æ”¯æŒ-UL-è·³è½¬"><a href="#è‡ªå®šä¹‰é“¾æ¥æ”¯æŒ-UL-è·³è½¬" class="headerlink" title="è‡ªå®šä¹‰é“¾æ¥æ”¯æŒ UL è·³è½¬"></a>è‡ªå®šä¹‰é“¾æ¥æ”¯æŒ UL è·³è½¬</h4><p>å¦‚æœæƒ³è¦åœ¨ç½‘é¡µä¸­æ”¯æŒè‡ªå®šä¹‰ UL è·³è½¬ï¼Œæ¯”å¦‚åœ¨åº•éƒ¨æµ®åŠ¨ä¸€ä¸ª <code>banner</code> ï¼Œä¸Šé¢æ˜¾ç¤º <code>æ‰“å¼€ App</code>ï¼Œåœ¨å®‰è£…äº†ç›¸åº”çš„ app çš„æƒ…å†µä¸‹ï¼Œå¦‚æœæƒ³è¦è¾¾åˆ°ç‚¹å‡»è¿™ä¸ªé“¾æ¥è‡ªåŠ¨è·³è½¬åˆ°è¯¥ app çš„ç›®çš„ï¼Œæ­¤æ—¶è¿™ä¸ª <code>banner</code> çš„è·³è½¬é“¾æ¥å¿…é¡»æ˜¯ä¹‹å‰ <code>Xcode</code> ä¸­é…ç½®çš„ <code>Associated Domains</code> ä¸­åŸŸåä¸‹çš„é“¾æ¥ã€‚</p>
<h5 id="è·¨åŸŸæ¡ä»¶"><a href="#è·¨åŸŸæ¡ä»¶" class="headerlink" title="* è·¨åŸŸæ¡ä»¶"></a>* è·¨åŸŸæ¡ä»¶</h5><p>æƒ³è¦è¾¾åˆ°è‡ªå®šä¹‰è·³è½¬çš„ç›®çš„ï¼Œå¿…é¡»æ»¡è¶³ <strong>è·¨åŸŸ</strong> çš„æ¡ä»¶ï¼Œä¸¾ä¾‹å‡è®¾å½“å‰ Safari æˆ–è€…å¾®ä¿¡æµè§ˆå™¨ä¸­ç½‘é¡µé“¾æ¥ä¸º <code>www.baidu.com/XXX/YYY</code>ï¼Œåº•éƒ¨â€œæ‰“å¼€Appâ€æŒ‰é’®å¯¹åº”çš„é“¾æ¥URLä¸º <code>www.baidu.com/AAA/BBB</code>ï¼Œç”±äºä¸¤è€…éƒ½åœ¨ç™¾åº¦çš„åŸŸåä¸‹ï¼Œå› æ­¤å®é™…ä¸èƒ½å®Œæˆè·³è½¬åˆ° appã€‚</p>
<h5 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h5><p>ç”±äºå¯¹å‰ç«¯å¼€å‘ä¸ç†Ÿï¼Œæ‰€ä»¥æ²¡æ€ä¹ˆç ”ç©¶ï¼Œè¿™é‡Œæä¾›ä¸¤ä¸ªå‰ç«¯ä½¿ç”¨ UL çš„å‚è€ƒé“¾æ¥ã€‚</p>
<p><a href="https://juejin.im/post/57b6ba9f128fe10054bb5401" target="_blank" rel="external">æµè§ˆå™¨ä¸­å”¤èµ·native app || è·³è½¬åˆ°åº”ç”¨å•†åŸä¸‹è½½ï¼ˆä¸€ï¼‰</a><br><a href="https://juejin.im/post/57bd1c3079bc440063b38f9d" target="_blank" rel="external">æµè§ˆå™¨ä¸­å”¤èµ·native app || è·³è½¬åˆ°åº”ç”¨å•†åŸä¸‹è½½ï¼ˆäºŒï¼‰ ä¹‹ universal links</a></p>
<hr>
<h2 id="æ³¨æ„ç‚¹åŠæ€»ç»“"><a href="#æ³¨æ„ç‚¹åŠæ€»ç»“" class="headerlink" title="æ³¨æ„ç‚¹åŠæ€»ç»“"></a>æ³¨æ„ç‚¹åŠæ€»ç»“</h2><h3 id="æ³¨æ„ç‚¹"><a href="#æ³¨æ„ç‚¹" class="headerlink" title="æ³¨æ„ç‚¹"></a>æ³¨æ„ç‚¹</h3><ol>
<li>iOS 9.3 ä¹‹åå¿…é¡»è·¨åŸŸæ‰èƒ½æ”¯æŒ UL è·³è½¬ã€‚</li>
<li>æœåŠ¡ç«¯å¿…é¡»æ˜¯ HTTPSã€‚</li>
<li><code>apple-app-site-association</code> æ–‡ä»¶çš„è®¿é—®å¿…é¡»ä¸æ”¯æŒé‡å®šå‘ã€‚</li>
</ol>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ”¾ä¸€å¼ è‡ªå·±æ€»ç»“çš„ç®€å•çš„ UL å·¥ä½œæµç¨‹å›¾ï¼Œæ–¹ä¾¿ç†è§£è·Ÿå›é¡¾ï¼š</p>
<p><img src="media/Apple%20Universal%20Links%20Work%20Flow.png" alt="Apple Universal Links Work Flow"></p>
<hr>
<h2 id="è¡¥å……"><a href="#è¡¥å……" class="headerlink" title="è¡¥å……"></a>è¡¥å……</h2><h3 id="åŸŸåéªŒè¯"><a href="#åŸŸåéªŒè¯" class="headerlink" title="åŸŸåéªŒè¯"></a>åŸŸåéªŒè¯</h3><p>è‹¹æœå®˜æ–¹æä¾›äº†ç½‘å€éªŒè¯å·¥å…·ï¼š<a href="https://search.developer.apple.com/appsearch-validation-tool/" target="_blank" rel="external">App Search API Validation Tool</a><br>ç”¨äºéªŒè¯ UL çš„æ¡ä»¶æœ‰æ²¡æœ‰æ»¡è¶³ï¼š</p>
<ol>
<li>æœåŠ¡å™¨åå°æ­£ç¡®ä¸Šä¼ äº† <code>apple-app-site-association</code> æ–‡ä»¶ã€‚</li>
<li>iOS ç«¯å¼€å¯ä¸”æ­£ç¡®é…ç½®äº† <code>Associated Domains</code>ã€‚</li>
</ol>
<p>å½“éªŒè¯é€šè¿‡ï¼Œä½†æ˜¯ä½ çš„ app è¿˜æ²¡æœ‰å‘å¸ƒåˆ° App Store æ—¶æ˜¾ç¤ºçš„ç»“æœæ˜¯ï¼š<br><img src="media/QQ20170414-023032@2x.png" alt=""></p>
<p>å¦‚æœ app å·²ç»å‘å¸ƒï¼Œä¸”éªŒè¯é€šè¿‡ï¼Œåˆ™æ˜¾ç¤ºçš„æ˜¯ PASSED çŠ¶æ€ï¼š<br><img src="media/716949-1755979ce9d20f91.jpeg" alt=""></p>
<h3 id="ç¬¬ä¸‰æ–¹æ”¯æŒ-UL-è·³è½¬çš„-APP-å¹³å°"><a href="#ç¬¬ä¸‰æ–¹æ”¯æŒ-UL-è·³è½¬çš„-APP-å¹³å°" class="headerlink" title="ç¬¬ä¸‰æ–¹æ”¯æŒ UL è·³è½¬çš„ APP/å¹³å°"></a>ç¬¬ä¸‰æ–¹æ”¯æŒ UL è·³è½¬çš„ APP/å¹³å°</h3><p>éå®Œæ•´ç‰ˆ : )</p>
<table>
<thead>
<tr>
<th style="text-align:center">App Name</th>
<th style="text-align:center">æ˜¯å¦æ”¯æŒ UL è·³è½¬</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">å¾®åš</td>
<td style="text-align:center">âœ”ï¸</td>
</tr>
<tr>
<td style="text-align:center">å¾®ä¿¡</td>
<td style="text-align:center">âœ”ï¸</td>
</tr>
<tr>
<td style="text-align:center">Safari</td>
<td style="text-align:center">âœ”ï¸</td>
</tr>
<tr>
<td style="text-align:center">QQ</td>
<td style="text-align:center">âœ”ï¸</td>
</tr>
<tr>
<td style="text-align:center">æ‰‹æœºç™¾åº¦</td>
<td style="text-align:center">âœ”ï¸</td>
</tr>
<tr>
<td style="text-align:center">UC æµè§ˆå™¨</td>
<td style="text-align:center">âœ”ï¸</td>
</tr>
<tr>
<td style="text-align:center">æ”¯ä»˜å®</td>
<td style="text-align:center">âœ”ï¸</td>
</tr>
<tr>
<td style="text-align:center">QQ æµè§ˆå™¨</td>
<td style="text-align:center">âœ—</td>
</tr>
<tr>
<td style="text-align:center">Chrome æµè§ˆå™¨</td>
<td style="text-align:center">âœ—</td>
</tr>
<tr>
<td style="text-align:center">â€¦</td>
<td style="text-align:center">â€¦</td>
</tr>
</tbody>
</table>
<h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>å½“åœ¨ Safari æˆ–è€…ç¬¬ä¸‰æ–¹åˆ†äº«çš„å¹³å°ä¸­ç‚¹å‡» UL é“¾æ¥æ‰“å¼€ app åï¼Œä¼šåœ¨ app å³ä¸Šè§’çœ‹åˆ°ç±»ä¼¼ <code>example.com</code> çš„ç®­å¤´æŒ‡ç¤ºï¼Œå¦‚æœç‚¹å‡»å®ƒä¼šè·³è½¬åˆ° <code>Safari</code> æ‰“å¼€ä¹‹å‰ç‚¹å‡»çš„é“¾æ¥ï¼ŒåŒæ—¶ç³»ç»Ÿä¼šè®¤ä¸ºä½ é€‰æ‹©ä½¿ç”¨ <code>Safari</code> æ‰“å¼€è¯¥åŸŸåçš„é“¾æ¥ï¼Œè€Œä¸æ˜¯ appã€‚é‚£ä¹ˆä¸‹æ¬¡ä½ å†ç‚¹å‡»è¯¥é“¾æ¥ï¼Œå®ƒåªä¼šåœ¨ <code>Safari</code> é‡Œé¢åŠ è½½è¯¥é“¾æ¥ã€‚é‚£ä¹ˆå¦‚ä½•å†æ¬¡å¼€å¯ app è·³è½¬å‘¢ï¼Ÿåœ¨ <code>Safari</code> é¡µé¢ä¸­ï¼Œæ‰‹æŒ‡å¾€ä¸‹æ‹‰åŠ¨æ˜¾ç¤ºå‡º <code>Smart App Banner</code>ï¼Œç‚¹å‡»å³ä¾§çš„ <code>æ‰“å¼€</code> æŒ‰é’®ï¼Œå°±ä¼šè·³è½¬åˆ° appï¼Œæ­¤æ—¶ç³»ç»Ÿå°±ä¼šè®¤ä¸ºä½ é€‰æ‹©ä½¿ç”¨ app è·³è½¬ï¼Œä¸‹æ¬¡å†æ¬¡ç‚¹å‡»é“¾æ¥æ—¶ä¹Ÿä¼šç›´æ¥è·³è½¬åˆ° app äº†ã€‚</p>
<p><img src="media/IMG_1105.PNG" alt="-w300"> <img src="media/IMG_1107.PNG" alt="-w300"></p>
<h3 id="å‚è€ƒé“¾æ¥-1"><a href="#å‚è€ƒé“¾æ¥-1" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h3><ul>
<li><p>iOS:<br>  <a href="https://developer.apple.com/library/content/documentation/General/Conceptual/AppSearch/UniversalLinks.html" target="_blank" rel="external">https://developer.apple.com/library/content/documentation/General/Conceptual/AppSearch/UniversalLinks.html</a><br>  <a href="https://developer.apple.com/videos/play/wwdc2015/509/" target="_blank" rel="external">https://developer.apple.com/videos/play/wwdc2015/509/</a></p>
<p>  <a href="http://www.jianshu.com/p/c2ca5b5f391f" target="_blank" rel="external">http://www.jianshu.com/p/c2ca5b5f391f</a><br>  <a href="http://www.jianshu.com/p/d1e0c1886046" target="_blank" rel="external">http://www.jianshu.com/p/d1e0c1886046</a><br>  <a href="http://www.jianshu.com/p/aeca84ea2624" target="_blank" rel="external">http://www.jianshu.com/p/aeca84ea2624</a></p>
<p>  <a href="http://stackoverflow.com/questions/35609667/how-to-support-universal-links-in-ios-app-and-setup-server-for-it/35609668#35609668" target="_blank" rel="external">http://stackoverflow.com/questions/35609667/how-to-support-universal-links-in-ios-app-and-setup-server-for-it/35609668#35609668</a><br>  <a href="http://stackoverflow.com/questions/32751225/ios9-universal-links-does-not-work" target="_blank" rel="external">http://stackoverflow.com/questions/32751225/ios9-universal-links-does-not-work</a></p>
<p>  <a href="http://blog.hokolinks.com/how-to-implement-apple-universal-links-on-ios-9/" target="_blank" rel="external">HOKO - Breaking down iOS 9 Universal Links</a></p>
</li>
<li><p>Android:<br>  <a href="http://blog.hokolinks.com/android-m-app-links-implementation-drawbacks/" target="_blank" rel="external">HOKO - Android M App Links: implementation, drawbacks and solutions</a></p>
</li>
<li><p>å‰ç«¯:<br>  <a href="https://juejin.im/post/57b6ba9f128fe10054bb5401" target="_blank" rel="external">æµè§ˆå™¨ä¸­å”¤èµ·native app || è·³è½¬åˆ°åº”ç”¨å•†åŸä¸‹è½½ï¼ˆä¸€ï¼‰</a><br>  <a href="https://juejin.im/post/57bd1c3079bc440063b38f9d" target="_blank" rel="external">æµè§ˆå™¨ä¸­å”¤èµ·native app || è·³è½¬åˆ°åº”ç”¨å•†åŸä¸‹è½½ï¼ˆäºŒï¼‰ ä¹‹ universal links</a></p>
</li>
</ul>
<hr>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ä½¿ç”¨ Moco è½»æ¾æ­å»ºæµ‹è¯•æœåŠ¡å™¨]]></title>
      <url>http://raykle.coding.me/2016/09/03/%E4%BD%BF%E7%94%A8-Moco-%E8%BD%BB%E6%9D%BE%E6%90%AD%E5%BB%BA%E6%B5%8B%E8%AF%95%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
      <content type="html"><![CDATA[<p>æ–°å…¬å¸çš„é¡¹ç›®ä½¿ç”¨äº† <a href="http://rap.taobao.org/" target="_blank" rel="external">RAP</a> è¿™ä¸€é˜¿é‡Œæ¨å‡ºçš„å¯è§†åŒ–æ¥å£ç®¡ç†å·¥å…·ï¼Œé€šè¿‡åœ¨ä¸Šé¢å®šä¹‰æ¥å£ï¼ŒRAP å¯ä»¥é€šè¿‡åˆ†ææ¥å£ç»“æ„ï¼Œä»¥ä¸€ç³»åˆ—è‡ªåŠ¨åŒ–å·¥å…·å¸®åŠ©å¼€å‘äººå‘˜æå‡æ•ˆç‡ã€‚é‡è¦çš„æ˜¯ RAP é€šè¿‡ Mock æœåŠ¡å¯ä»¥ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®ã€‚</p>
<p>ä»¥ä¸Šçš„è¿™äº›éƒ½ä¸æ˜¯è®¨è®ºçš„é‡ç‚¹ï¼Œæœ¬ç¯‡æ–‡ç« ä¸»è¦æ˜¯è®°å½•å¦‚ä½•é€šè¿‡ä½¿ç”¨ Moco æ­å»ºæœ¬åœ°æœåŠ¡å™¨ï¼Œä»¥è¾¾åˆ°åœ¨æ¥å£å®šä¹‰åˆæœŸï¼Œå°±å¯ä»¥é€šè¿‡ Moco è°ƒè¯•æ¥å£ï¼Œæ¨è¿›ç§»åŠ¨å¼€å‘çš„è¿›ç¨‹ã€‚</p>
<h2 id="Moco-ä»‹ç»"><a href="#Moco-ä»‹ç»" class="headerlink" title="Moco ä»‹ç»"></a>Moco ä»‹ç»</h2><p>Moco æ˜¯ä¸€ä¸ªåŸºäº Java å¼€å‘çš„å¼€æºé¡¹ç›®ï¼Œåœ¨ GitHub ä¸Šæœ‰ä¸å°‘çš„å…³æ³¨ï¼š<a href="https://github.com/dreamhead/moco" target="_blank" rel="external">https://github.com/dreamhead/moco</a></p>
<blockquote>
<p>Moco is an easy setup stub framework.</p>
</blockquote>
<h2 id="å¿«é€Ÿå¼€å§‹"><a href="#å¿«é€Ÿå¼€å§‹" class="headerlink" title="å¿«é€Ÿå¼€å§‹"></a>å¿«é€Ÿå¼€å§‹</h2><ol>
<li><p>ä¸‹è½½ç¼–è¯‘å¥½çš„ Jar æ–‡ä»¶ï¼Œç›®å‰ç‰ˆæœ¬æ˜¯ 0.11.0ï¼š<br><a href="https://repo1.maven.org/maven2/com/github/dreamhead/moco-runner/0.11.0/moco-runner-0.11.0-standalone.jar" target="_blank" rel="external">https://repo1.maven.org/maven2/com/github/dreamhead/moco-runner/0.11.0/moco-runner-0.11.0-standalone.jar</a></p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¹‹ååœ¨è¿è¡Œæ­¤ Jar æ–‡ä»¶æ—¶ï¼Œéœ€è¦é¢„å…ˆå®‰è£…å¥½ Java çš„ JDKã€‚å¦‚æœä¸çŸ¥é“æœ‰æ²¡æœ‰å®‰è£…è¿‡ï¼Œå¯åœ¨ä¸‹è½½å®Œä¸Šé¢çš„ Jar æ–‡ä»¶åï¼ŒåŒå‡»æ‰“å¼€ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•æç¤ºçš„è¯ï¼Œè¯´æ˜å·²ç»å®‰è£…è¿‡ JDKï¼Œå¦åˆ™ä¼šæœ‰ä¸€ä¸ªæç¤ºå»ä¸‹è½½çš„å¼¹å‡ºæ¡†ã€‚JDK ä¸‹è½½åœ°å€ä¸ºï¼š<a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="external">http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a> ï¼Œé€‰æ‹©é€‚åˆè‡ªå·±ç”µè„‘ç³»ç»Ÿçš„ç‰ˆæœ¬è¿›è¡Œä¸‹è½½å®‰è£…ã€‚</p>
</blockquote>
</li>
<li><p>ç¼–å†™é…ç½®æ–‡ä»¶ï¼Œåƒä¸‹é¢è¿™ä¸ªæ ·å­æè¿°ä½ çš„ Moco æœåŠ¡çš„é…ç½®ï¼š</p>
 <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="attr">"response"</span> : &#123;</span><br><span class="line">        <span class="attr">"text"</span> : <span class="string">"Hello World"</span></span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p> å¹¶å‘½åä¸º foo.json ã€‚</p>
</li>
<li><p>é€šè¿‡é…ç½®æ–‡ä»¶ foo.json å¯åŠ¨ Moco æœåŠ¡<br> åœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar moco-runner-&lt;version&gt;-standalone.jar http -p 12306 -c foo.json</span><br></pre></td></tr></table></figure>
<p> å…¶ä¸­ <code>&lt;version&gt;</code> æ›¿æ¢ä¸ºä¸‹è½½çš„ Jar åŒ…çš„ç‰ˆæœ¬ï¼Œæ­¤å¤„ä¸º <code>0.11.0</code> ï¼Œæ‰€ä»¥æ‰§è¡Œï¼š<code>java -jar moco-runner-0.11.0-standalone.jar http -p 12306 -c foo.json</code> ã€‚<br> -p æŒ‡å®š Moco æœåŠ¡ç«¯å£ã€‚</p>
<blockquote>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ‰§è¡Œä»¥ä¸Šçš„å‘½ä»¤ï¼Œéœ€è¦å…ˆ cd åˆ° Jar æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œç„¶å foo.json æ–‡ä»¶ä¹Ÿéœ€è¦æ”¾åœ¨åŒä¸€ä¸ªç›®å½•æ‰è¡Œï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚æˆ–è€…å¯ä»¥é€šè¿‡ä½¿ç”¨ Jar æ–‡ä»¶å’Œ .json æ–‡ä»¶ç»å¯¹è·¯å¾„çš„æ–¹å¼ä¹Ÿå¯ä»¥ã€‚<br>json æ–‡ä»¶è·¯å¾„ä¹Ÿå¯ä»¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œå¦‚ï¼š./json/foo.json</p>
</blockquote>
</li>
<li><p>è®¿é—® Web æœåŠ¡<br> æµè§ˆå™¨è®¿é—®ï¼š<code>http://localhost:12306</code> ï¼Œå°±å¯ä»¥çœ‹åˆ°ä»¤äººæƒŠå–œçš„ â€œHello Worldâ€ äº†ã€‚: )</p>
<hr>
</li>
</ol>
<h2 id="è¿›é˜¶ä½¿ç”¨"><a href="#è¿›é˜¶ä½¿ç”¨" class="headerlink" title="è¿›é˜¶ä½¿ç”¨"></a>è¿›é˜¶ä½¿ç”¨</h2><p>å…·ä½“ä½¿ç”¨å¯å‚è€ƒ Moco çš„ <a href="https://github.com/dreamhead/moco/blob/master/moco-doc/apis.md" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a></p>
<h3 id="description-å­—æ®µä½œä¸ºæ³¨é‡Š"><a href="#description-å­—æ®µä½œä¸ºæ³¨é‡Š" class="headerlink" title="description å­—æ®µä½œä¸ºæ³¨é‡Š"></a>description å­—æ®µä½œä¸ºæ³¨é‡Š</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"description"</span>: <span class="string">"any response"</span>,</span><br><span class="line">        <span class="attr">"response"</span>: &#123;</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"foo"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>åœ¨æ‰€æœ‰çš„ JSON APIs ä¸­ï¼Œä½¿ç”¨ <code>description</code> å­—æ®µä½œä¸ºæè¿°æ­¤é…ç½®çš„ä½œç”¨ï¼Œåœ¨æœåŠ¡å¯åŠ¨æ—¶æ­¤å­—æ®µä¼šè¢«è‡ªåŠ¨å¿½ç•¥æ‰ã€‚</p>
<hr>
<h3 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h3><h4 id="URI"><a href="#URI" class="headerlink" title="URI"></a>URI</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"uri"</span> : <span class="string">"/foo"</span></span><br><span class="line">        &#125;,</span><br><span class="line">         <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"bar"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è®¿é—® <code>http://localhost:12306/foo</code> ,å°±å¯ä»¥è·å–åˆ°å†…å®¹ï¼šbarã€‚</p>
<h4 id="Query-Parameter"><a href="#Query-Parameter" class="headerlink" title="Query Parameter"></a>Query Parameter</h4><p>å¸¦æœ‰å‚æ•°çš„è¯·æ±‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"uri"</span> : <span class="string">"/foo"</span>,</span><br><span class="line">          <span class="attr">"queries"</span> : &#123;</span><br><span class="line">              <span class="attr">"param"</span> : <span class="string">"blah"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"bar"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è®¿é—® <code>http://localhost:12306/foo?param=blah</code> è·å–åˆ°å†…å®¹ï¼šbarã€‚</p>
<h4 id="HTTP-Method"><a href="#HTTP-Method" class="headerlink" title="HTTP Method"></a>HTTP Method</h4><p>æ ¹æ®æŒ‡å®šçš„ HTTP æ–¹æ³•è¿”å› response ï¼Œä¹Ÿéå¸¸å®¹æ˜“è®¾ç½®ã€‚<br>è®¾ç½® GET è¯·æ±‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">   &#123;</span><br><span class="line">     <span class="attr">"request"</span> : &#123;</span><br><span class="line">         <span class="attr">"method"</span> : <span class="string">"get"</span>,</span><br><span class="line">         <span class="attr">"uri"</span> : <span class="string">"/foo"</span></span><br><span class="line">       &#125;,</span><br><span class="line">     <span class="attr">"response"</span> : &#123;</span><br><span class="line">         <span class="attr">"text"</span> : <span class="string">"bar"</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>GET è¯·æ±‚ <code>http://localhost:12306/foo</code> è·å–åˆ°å†…å®¹ï¼šbarã€‚</p>
<p>è®¾ç½®å…¶ä»–è¯·æ±‚åŒç†ã€‚</p>
<h4 id="Header"><a href="#Header" class="headerlink" title="Header"></a>Header</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"method"</span> : <span class="string">"post"</span>,</span><br><span class="line">          <span class="attr">"headers"</span> : &#123;</span><br><span class="line">            <span class="attr">"content-type"</span> : <span class="string">"application/json"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"bar"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"uri"</span> : <span class="string">"/cookie"</span>,</span><br><span class="line">          <span class="attr">"cookies"</span> : &#123;</span><br><span class="line">              <span class="attr">"login"</span> : <span class="string">"true"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"success"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="Form"><a href="#Form" class="headerlink" title="Form"></a>Form</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"method"</span> : <span class="string">"post"</span>,</span><br><span class="line">          <span class="attr">"forms"</span> : &#123;</span><br><span class="line">              <span class="attr">"name"</span> : <span class="string">"foo"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"bar"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h4><p>XML æ ¼å¼ç›®å‰ä¹Ÿè¿˜åœ¨æµè¡Œç€ï¼Œé…ç½®æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span>: &#123;</span><br><span class="line">          <span class="attr">"uri"</span>: <span class="string">"/xml"</span>,</span><br><span class="line">          <span class="attr">"text"</span>: &#123;</span><br><span class="line">              <span class="attr">"xml"</span>: <span class="string">"&lt;request&gt;&lt;parameters&gt;&lt;id&gt;1&lt;/id&gt;&lt;/parameters&gt;&lt;/request&gt;"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span>: &#123;</span><br><span class="line">          <span class="attr">"text"</span>: <span class="string">"foo"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>å¦‚æœ XML æ–‡ä»¶å¾ˆå¤§çš„è¯ï¼Œå¯ä»¥æ”¾åœ¨ä¸€ä¸ª xml æ–‡ä»¶ä¸­ï¼Œç„¶åé€šè¿‡å¼•ç”¨æ–‡ä»¶è·¯å¾„çš„æ–¹å¼æ¥å‘èµ·è¯·æ±‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">       <span class="attr">"request"</span>: &#123;</span><br><span class="line">            <span class="attr">"uri"</span>: <span class="string">"/xml"</span>,</span><br><span class="line">            <span class="attr">"file"</span>: &#123;</span><br><span class="line">                <span class="attr">"xml"</span>: <span class="string">"your_file.xml"</span></span><br><span class="line">              &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span>: &#123;</span><br><span class="line">          <span class="attr">"text"</span>: <span class="string">"foo"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="JSON-Request"><a href="#JSON-Request" class="headerlink" title="JSON Request"></a>JSON Request</h4><h5 id="JSON-Text"><a href="#JSON-Text" class="headerlink" title="JSON Text"></a>JSON Text</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">   &#123;</span><br><span class="line">        <span class="attr">"request"</span>: &#123;</span><br><span class="line">            <span class="attr">"uri"</span>: <span class="string">"/json"</span>,</span><br><span class="line">            <span class="attr">"json"</span>: &#123;</span><br><span class="line">                <span class="attr">"foo"</span>: <span class="string">"bar"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"response"</span>: &#123;</span><br><span class="line">            <span class="attr">"text"</span>: <span class="string">"foo"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è®¿é—® <code>http://localhost:12306/json</code> ï¼Œå°† <code>{&quot;foo&quot;: &quot;bar&quot;}</code> ä½œä¸ºå­—ç¬¦ä¸² POST åˆ°æœåŠ¡å™¨ã€‚</p>
<h4 id="Operator"><a href="#Operator" class="headerlink" title="Operator"></a>Operator</h4><h5 id="Match"><a href="#Match" class="headerlink" title="Match"></a>Match</h5><p>ä½ å¯èƒ½æƒ³é€šè¿‡æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…ä½ çš„ requestï¼Œ<strong>match</strong> å¯ä»¥å¸®åˆ°ä½ <br>æ¯”å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span>: &#123;</span><br><span class="line">          <span class="attr">"uri"</span>: &#123;</span><br><span class="line">              <span class="attr">"match"</span>: <span class="string">"/\\w*/foo"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span>: &#123;</span><br><span class="line">          <span class="attr">"text"</span>: <span class="string">"bar"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>åŒ¹é…ä»»æ„ç±»ä¼¼ <code>http://localhost:12306/xxx/foo</code> çš„è¯·æ±‚ï¼Œå¹¶è¿”å›ï¼šbarã€‚å…¶ä¸­çš„ <code>/\\w*</code> è¡¨ç¤ºä»¥ <code>/</code> å¼€å§‹ï¼Œä¹‹åæ˜¯ä»»æ„æ•°é‡çš„æ•°å­—æˆ–å­—æ¯ã€‚</p>
<h5 id="Starts-With-Ends-With-Contain"><a href="#Starts-With-Ends-With-Contain" class="headerlink" title="Starts With, Ends With, Contain"></a>Starts With, Ends With, Contain</h5><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span>: &#123;</span><br><span class="line">          <span class="attr">"uri"</span>: &#123;</span><br><span class="line">              <span class="attr">"startsWith"</span>: <span class="string">"/foo"</span></span><br><span class="line">              //<span class="string">"endsWith"</span>: <span class="string">"foo"</span></span><br><span class="line">              //<span class="string">"contain"</span>: <span class="string">"foo"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span>: &#123;</span><br><span class="line">          <span class="attr">"text"</span>: <span class="string">"bar"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h3><h4 id="Content"><a href="#Content" class="headerlink" title="Content"></a>Content</h4><p>æ­£å¦‚åœ¨ä¹‹å‰çš„å®ä¾‹ä¸­çœ‹åˆ°çš„ï¼Œç›´æ¥è¿”å›ä¸€ä¸ªæ–‡å­—å†…å®¹éå¸¸ç®€å•ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"foo"</span></span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"bar"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è®¿é—® <code>http://localhost:12306/</code> å°† foo ä½œä¸ºå­—ç¬¦ä¸² POST åˆ°æœåŠ¡ç«¯ï¼Œåˆ™ä¼šç›´æ¥è¿”å›å†…å®¹ï¼šbarã€‚<br>å’Œ request ä¸€æ ·ï¼Œå¦‚æœ response å†…å®¹å¾ˆå¤šçš„è¯ï¼Œå¯ä»¥æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­è¿”å›ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"foo"</span></span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"file"</span> : <span class="string">"bar.response"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="Status-Code"><a href="#Status-Code" class="headerlink" title="Status Code"></a>Status Code</h4><p>Moco æ”¯æŒ HTTP çŠ¶æ€ç çš„è¿”å›ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"foo"</span></span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"status"</span> : <span class="number">200</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="Header-1"><a href="#Header-1" class="headerlink" title="Header"></a>Header</h4><p>æˆ‘ä»¬åŒæ ·å¯ä»¥åœ¨ response ä¸­æŒ‡å®š HTTP Headerã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"foo"</span></span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"headers"</span> : &#123;</span><br><span class="line">              <span class="attr">"content-type"</span> : <span class="string">"application/json"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="Proxy"><a href="#Proxy" class="headerlink" title="Proxy"></a>Proxy</h4><h5 id="Single-URL"><a href="#Single-URL" class="headerlink" title="Single URL"></a>Single URL</h5><p>æˆ‘ä»¬å¯ä»¥åƒ proxy ä¸€æ ·ï¼Œè¿”å›ä¸€ä¸ªæŒ‡å®šçš„ URLã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"foo"</span></span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"proxy"</span> : <span class="string">"http://www.github.com"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>å®é™…ä¸Šï¼Œproxy è¦æ›´åŠ çš„å¼ºå¤§ã€‚å®ƒå¯ä»¥å°†æ‰€æœ‰çš„è¯·æ±‚éƒ½æŒ‡å‘æŒ‡å®šçš„ urlï¼ŒåŒ…æ‹¬ HTTP çš„ methodï¼Œversionï¼Œheaderï¼Œcontent ç­‰ç­‰ã€‚</p>
<h5 id="Failover"><a href="#Failover" class="headerlink" title="Failover"></a>Failover</h5><p>é™¤äº†åŸºç¡€åŠŸèƒ½ä¹‹å¤–ï¼Œproxy ä¹Ÿæ”¯æŒ failoverï¼Œè¿™æ„å‘³ç€å¦‚æœè¿œç¨‹æœåŠ¡æš‚æ—¶ä¸èƒ½èµ·ä½œç”¨çš„è¯ï¼Œmoco æœåŠ¡å°†çŸ¥é“ä»æœ¬åœ°çš„é…ç½®ä¸­ä¿®å¤ã€‚<br>ä¾‹å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"foo"</span></span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"proxy"</span> : &#123;</span><br><span class="line">              <span class="attr">"url"</span> : <span class="string">"http://localhost:12306/unknown"</span>,</span><br><span class="line">              <span class="attr">"failover"</span> : <span class="string">"failover.json"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>Proxy ä¼šå°† request/response æˆå¯¹åœ°ä¿å­˜åœ¨ä½ æŒ‡å®šçš„ failover æ–‡ä»¶ä¸­ã€‚å¦‚æœ proxy æŒ‡å®šçš„ç›®æ ‡ä¸å¯ç”¨ï¼Œproxy å°†ä»è¿™ä¸ªæ–‡ä»¶ä¸­æ¢å¤ã€‚è¿™ä¸ªåŠŸèƒ½åœ¨å¼€å‘ç¯å¢ƒä¸‹éå¸¸æœ‰ç”¨ï¼Œå°¤å…¶æ˜¯å½“é›†æˆæœåŠ¡è¿˜æ²¡æœ‰ç¨³å®šçš„æ—¶å€™ã€‚</p>
<h5 id="Playback"><a href="#Playback" class="headerlink" title="Playback"></a>Playback</h5><p>Moco ä¹Ÿæ”¯æŒ playbackï¼Œæ”¯æŒå°†è¿œç¨‹çš„ request å’Œ response ä¿å­˜åˆ°æœ¬åœ°æ–‡ä»¶ä¸­ã€‚failover å’Œ playback çš„ä¸åŒæ”¯æŒåœ¨äºï¼Œplayback åªä¼šå½“æœ¬åœ°çš„ request å’Œ response ä¸å¯ç”¨æ—¶æ‰ä¼šè¿›å…¥è¿œç¨‹æœåŠ¡ã€‚</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"foo"</span></span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"proxy"</span> : &#123;</span><br><span class="line">              <span class="attr">"url"</span> : <span class="string">"http://localhost:12306/unknown"</span>,</span><br><span class="line">              <span class="attr">"playback"</span> : <span class="string">"playback.json"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="Redirect"><a href="#Redirect" class="headerlink" title="Redirect"></a>Redirect</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"uri"</span> : <span class="string">"/redirect"</span></span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"redirectTo"</span> : <span class="string">"http://www.github.com"</span></span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h4 id="Cookie-1"><a href="#Cookie-1" class="headerlink" title="Cookie"></a>Cookie</h4><p>Cookie åŒæ ·å¯ä»¥æ”¾åœ¨ response ä¸­ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"uri"</span> : <span class="string">"/cookie"</span></span><br><span class="line">        &#125;,</span><br><span class="line">      <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"cookies"</span> : &#123;</span><br><span class="line">            <span class="attr">"login"</span> : <span class="string">"true"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>å½“è®¿é—® <code>http://localhost:12306/cookie</code> æ—¶ï¼Œåœ¨è¿”å›çš„ Header ä¸­å°†ä¼šçœ‹åˆ°ï¼š<code>Set-Cookie : login=true; Path=/</code></p>
<h4 id="JSON-Response"><a href="#JSON-Response" class="headerlink" title="JSON Response"></a>JSON Response</h4><p>å¯¹äº JSON APIï¼Œ ç›´æ¥è¿”å›ä¸€ä¸ª json object å°±å¯ä»¥äº†ã€‚æ¯”å¦‚:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"request"</span>: &#123;</span><br><span class="line">            <span class="attr">"uri"</span>: <span class="string">"/json"</span></span><br><span class="line">          &#125;,</span><br><span class="line">        <span class="attr">"response"</span>: &#123;</span><br><span class="line">            <span class="attr">"json"</span>: &#123;</span><br><span class="line">                <span class="attr">"foo"</span> : <span class="string">"bar"</span></span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>è®¿é—® <code>http://localhost:12306/json</code>ï¼Œåˆ™ä¼šè¿”å› jsonï¼š<code>{&quot;foo&quot;:&quot;bar&quot;}</code></p>
<h2 id="ä½¿ç”¨æŠ€å·§"><a href="#ä½¿ç”¨æŠ€å·§" class="headerlink" title="ä½¿ç”¨æŠ€å·§"></a>ä½¿ç”¨æŠ€å·§</h2><h3 id="é…ç½®æ–‡ä»¶"><a href="#é…ç½®æ–‡ä»¶" class="headerlink" title="é…ç½®æ–‡ä»¶"></a>é…ç½®æ–‡ä»¶</h3><p>ç®€å•åœ°å¯åŠ¨ moco æœåŠ¡æ—¶æ˜¯é€šè¿‡å‘½ä»¤æ¥å¯åŠ¨çš„ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar moco-runner-&lt;version&gt;-standalone.jar http -p 12306 -c foo.json</span><br></pre></td></tr></table></figure>
<p>æ³¨æ„åˆ°è¿™é‡Œæœ‰ä¸€ä¸ª <code>-c foo.json</code> ï¼Œæ­¤æ—¶åªä¼šå°† <code>foo.json</code> é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹åŠ è½½åˆ°æœåŠ¡ä¸­ï¼Œå¦‚æœä»…ä»…é€šè¿‡ä»¥ä¸Šçš„å‘½ä»¤ï¼Œåˆ™åœ¨è°ƒè¯•å¤šä¸ªæ¥å£æ—¶ï¼Œéœ€è¦ä¸æ–­çš„åœæ­¢æ—§çš„æœåŠ¡ã€é€šè¿‡æ–°çš„ json é…ç½®æ–‡ä»¶å¯åŠ¨æ–°çš„æœåŠ¡ï¼Œéå¸¸éº»çƒ¦ã€‚</p>
<blockquote>
<p>Moco æ”¯æŒåŠ¨æ€åŠ è½½é…ç½®æ–‡ä»¶ï¼Œæ— è®ºæ˜¯ä¿®æ”¹è¿˜æ˜¯æ·»åŠ é…ç½®æ–‡ä»¶éƒ½æ˜¯ä¸éœ€è¦é‡å¯æœåŠ¡çš„ã€‚</p>
</blockquote>
<h4 id="é…ç½®æ–‡ä»¶çš„è®¾ç½®æŠ€å·§"><a href="#é…ç½®æ–‡ä»¶çš„è®¾ç½®æŠ€å·§" class="headerlink" title="é…ç½®æ–‡ä»¶çš„è®¾ç½®æŠ€å·§"></a>é…ç½®æ–‡ä»¶çš„è®¾ç½®æŠ€å·§</h4><p>é…ç½®æ–‡ä»¶çš„æ ¼å¼ä¸ºä¸€ä¸ª <strong>æ•°ç»„</strong> ç±»å‹çš„ JSON æ ¼å¼ï¼Œæ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ª <code>request/response</code> çš„é…å¯¹ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        // æ­¤å¤„é…ç½®äº†ä¸€ä¸ª request</span><br><span class="line">        "request" : &#123;</span><br><span class="line">          "uri" : "/foo"</span><br><span class="line">        &#125;,</span><br><span class="line">        // æ­¤å¤„é…ç½®äº†å¯¹åº”äºä¸Šæ–¹ request çš„ response</span><br><span class="line">        "response" : &#123;</span><br><span class="line">          "text" : "bar"</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ä¸€ä¸ª request/response å¯¹ï¼Œå½“ä¸­çš„ request å¯ä»¥æ²¡æœ‰ï¼Œåˆ™æ­¤æ—¶è®¿é—® <code>http://localhost:12306/</code> æ—¶ï¼ŒMoco å°±ä¼šç›´æ¥å°†é…ç½®çš„ response ä¸­çš„å†…å®¹è¿”å›ã€‚</p>
</blockquote>
<p>ä¸Šé¢è¯´äº†é…ç½®æ–‡ä»¶å†…å®¹æ˜¯ <strong>æ•°ç»„</strong> ç±»å‹çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜å¯ä»¥è¿™æ ·å†™ï¼š</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"uri"</span> : <span class="string">"/foo"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"bar"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">"request"</span> : &#123;</span><br><span class="line">          <span class="attr">"uri"</span> : <span class="string">"/foo2"</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">"response"</span> : &#123;</span><br><span class="line">          <span class="attr">"text"</span> : <span class="string">"bar2"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>æ­¤æ—¶æˆ‘ä»¬åŠ è½½äº†è¿™ä¸ªé…ç½®æ–‡ä»¶åï¼Œå¯ä»¥é€šè¿‡ <code>http://localhost:12306/foo</code> å’Œ <code>http://localhost:12306/foo2</code> åˆ†åˆ«è·å–åˆ° bar å’Œ bar2ã€‚è¿™ç§å¯¹äºéœ€è¦æµ‹è¯•çš„æ¥å£æ•°é‡è¾ƒå°‘æ—¶ï¼Œæ¯”è¾ƒå¿«é€Ÿæ–¹ä¾¿ã€‚</p>
<h4 id="å…¨å±€é…ç½®æ–‡ä»¶"><a href="#å…¨å±€é…ç½®æ–‡ä»¶" class="headerlink" title="å…¨å±€é…ç½®æ–‡ä»¶"></a>å…¨å±€é…ç½®æ–‡ä»¶</h4><p>Moco æ”¯æŒåœ¨å…¨å±€çš„é…ç½®æ–‡ä»¶ä¸­å¼•å…¥å…¶ä»–é…ç½®æ–‡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥åˆ†æœåŠ¡å®šä¹‰é…ç½®æ–‡ä»¶ï¼Œä¾¿äºç®¡ç†ã€‚<br>ä¾‹å¦‚ä½ æœ‰ä¸¤ä¸ªä¸åŒè·¯å¾„çš„ APIï¼š<code>http://xxx.com/path1/login</code> å’Œ <code>http://xxx.com/path2/pay</code> ï¼ˆç™»å½•å’Œæ”¯ä»˜æ¥å£ï¼‰ã€‚<br>æŒ‰ç…§ä¸Šä¸€å°èŠ‚ï¼ˆ4.1.1ï¼‰æ‰€è®²ï¼Œæˆ‘ä»¬å¯ä»¥å†™å¥½ login å’Œ pay çš„ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼ˆæˆ–å†™åœ¨ä¸€èµ·ï¼‰ï¼Œåˆ†åˆ«è®¾ç½® request çš„ url ä¸º <code>/path1/login</code> å’Œ <code>/path2/pay</code> ã€‚å¦‚æœéœ€è¦æµ‹è¯•çš„æ¥å£å¾ˆå¤šï¼Œåˆ™ä¸åˆ©äºç®¡ç†ï¼Œä¸” path1ã€path2 è¿™ä¹ˆæ··ä¹±çš„åˆ†å¸ƒäºä¸åŒçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œå¯¹äºä»¥åæƒ³è¦æ›´æ”¹ä¹Ÿå¾ˆä¸æ–¹ä¾¿ã€‚</p>
<p>æ­£ç¡®çš„å§¿åŠ¿åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š<br>åŒæ ·å†™å¥½ login.json å’Œ pay.json ä¸¤ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åå†™ä¸€ä¸ª <strong>å…¨å±€é…ç½®æ–‡ä»¶</strong> ï¼Œé…ç½®å¦‚ä¸‹ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// config.json</span><br><span class="line">[</span><br><span class="line">	&#123;"context":"/path1", "include":"login.json"&#125;,</span><br><span class="line">	&#123;"context":"/path2", "include":"pay.json"&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>login å’Œ pay ä¸¤ä¸ªæ–‡ä»¶æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå’Œä¹‹å‰çš„å†™æ³•ä¸€æ ·ã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">// register.json</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "request": &#123;</span><br><span class="line">            "uri": "/register",</span><br><span class="line">            "method": "POST",</span><br><span class="line">            "json": &#123;</span><br><span class="line">                "phone":"18688886666",</span><br><span class="line">                "password":"123456"</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "response": &#123;</span><br><span class="line">            "json": &#123;</span><br><span class="line">                "state":"0"</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">// login.json</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        "request": &#123;</span><br><span class="line">            "uri": "/login",</span><br><span class="line">            "method": "POST",</span><br><span class="line">            "json": &#123;</span><br><span class="line">                "amount":"100"</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        "response": &#123;</span><br><span class="line">            "json": &#123;</span><br><span class="line">                "state":"0"</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>ç„¶åå¯åŠ¨ Moco æœåŠ¡çš„å‘½ä»¤æ˜¯ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar moco-runner-&lt;version&gt;-standalone.jar http -p 12306 -g config.json</span><br></pre></td></tr></table></figure>
<p>è¦æ³¨æ„çš„æ˜¯ï¼Œæœ€åæŒ‡å®šçš„å‚æ•°æ˜¯ <strong><code>-g config.json</code></strong> !</p>
<p>å¦‚æœåªæ˜¯æƒ³å¼•å…¥å¤šä¸ª json æ–‡ä»¶çš„è¯ï¼Œå…¨å±€é…ç½®æ–‡ä»¶ä¸­å¯ä»¥ä¸ä½¿ç”¨ <code>context</code> å­—æ®µã€‚æ¯”å¦‚ï¼š</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ä¸ä½¿ç”¨ context å­—æ®µçš„ config.jsonã€‚</span><br><span class="line">[</span><br><span class="line">    &#123;"include":"login.json"&#125;,</span><br><span class="line">    &#123;"include":"pay.json"&#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<hr>
<p>ï¼ˆæŒç»­æ›´æ–°ä¸­â€¦ï¼‰</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ã€ŠiOS ä¸ OS X å¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹è¯»ä¹¦ç¬”è®°ä¹‹ GCDï¼ˆäºŒï¼‰]]></title>
      <url>http://raykle.coding.me/2016/08/16/%E3%80%8AiOS%20%E4%B8%8E%20OS%20X%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%20GCD%EF%BC%88%E4%BA%8C%EF%BC%89/</url>
      <content type="html"><![CDATA[<blockquote>
<p><a href="/2016/08/16/ã€ŠiOS ä¸ OS X å¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹è¯»ä¹¦ç¬”è®°ä¹‹ GCDï¼ˆä¸€ï¼‰/">ç¬¬ä¸€ç¯‡åŸºç¡€ç¯‡ ğŸ‘ˆ</a></p>
</blockquote>
<hr>
<h2 id="dispatch-set-target-queue"><a href="#dispatch-set-target-queue" class="headerlink" title="dispatch_set_target_queue"></a>dispatch_set_target_queue</h2><blockquote>
<p>ä½œç”¨ï¼šå˜æ›´ç”Ÿæˆçš„ Dispatch Queue çš„æ‰§è¡Œä¼˜å…ˆçº§ã€‚</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> targetQueue = dispatch_queue_create(<span class="string">"com.iBinaryOrg.targetQueue"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue1 = dispatch_queue_create(<span class="string">"queue1"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"><span class="comment">//è®¾ç½®ä¼˜å…ˆçº§</span></span><br><span class="line">dispatch_set_target_queue(queue1, targetQueue);</span><br></pre></td></tr></table></figure>
<p>dispatch_set_target_queue ä¸­ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæŒ‡å®šè¦å˜æ›´æ‰§è¡Œä¼˜å…ˆçº§çš„ Dispatch Queueï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸ºæŒ‡å®šçš„ä¸è¦ä½¿ç”¨çš„æ‰§è¡Œä¼˜å…ˆçº§ç›¸åŒä¼˜å…ˆçº§çš„ Dispatch Queueã€‚</p>
<p>å¦‚ä¸Šé¢ä»£ç ä¸­æ‰€ç¤ºï¼Œå°† Dispatch Queue æŒ‡å®šä¸º dispatch_set_target_queue å‡½æ•°çš„å‚æ•°ï¼Œä¸ä»…å¯ä»¥å˜æ›´ Dispatch Queue çš„æ‰§è¡Œä¼˜å…ˆçº§ï¼Œè¿˜å¯ä»¥ä½œä¸º Dispatch Queue çš„æ‰§è¡Œé˜¶å±‚ã€‚å¦‚æœåœ¨å¤šä¸ª Serial Dispatch Queue ä¸­ç”¨ dispatch_set_target_queue å‡½æ•°æŒ‡å®šç›®æ ‡ä¸ºæŸä¸€ä¸ª Serial Dispatch Queueï¼Œé‚£ä¹ˆåŸå…ˆæœ¬åº”è¯¥å¹¶è¡Œæ‰§è¡Œçš„å¤šä¸ª Serial Dispatch Queueï¼Œåœ¨ç›®æ ‡ Serial Dispatch Queue ä¸Šåªèƒ½åŒæ—¶æ‰§è¡Œä¸€ä¸ªå¤„ç†ã€‚</p>
<blockquote>
<p>åœ¨å¿…é¡»å°†ä¸å¯å¹¶è¡Œæ‰§è¡Œçš„å¤„ç†è¿½åŠ åˆ°å¤šä¸ª Serial Dispatch Queue ä¸­æ—¶ï¼Œå¦‚æœä½¿ç”¨ dispatch_set_target_queue å‡½æ•°å°†ç›®æ ‡æŒ‡å®šä¸ºæŸä¸€ä¸ª Serial Dispatch Queueï¼Œå³å¯é˜²æ­¢å¤„ç†å¹¶è¡Œæ‰§è¡Œã€‚</p>
</blockquote>
<p>æ¯”å¦‚ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)testTargetQueue &#123;</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> targetQueue = dispatch_queue_create(<span class="string">"com.iBinaryOrg.targetQueue"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//åˆ›å»º 3 ä¸ªåŒæ­¥é˜Ÿåˆ—</span></span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue1 = dispatch_queue_create(<span class="string">"queue1"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue2 = dispatch_queue_create(<span class="string">"queue2"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue3 = dispatch_queue_create(<span class="string">"queue3"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è®¾ç½®ä¼˜å…ˆçº§(æ ‡è®° 1)</span></span><br><span class="line">    dispatch_set_target_queue(queue1, targetQueue);</span><br><span class="line">    dispatch_set_target_queue(queue2, targetQueue);</span><br><span class="line">    dispatch_set_target_queue(queue3, targetQueue);</span><br><span class="line">	</span><br><span class="line">    <span class="built_in">dispatch_async</span>(targetQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"target queue in"</span>);</span><br><span class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">4</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"target queue out"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue1, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"1 in"</span>);</span><br><span class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">3</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"1 out"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue2, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"2 in"</span>);</span><br><span class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"2 out"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue3, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"3 in"</span>);</span><br><span class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"3 out"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2016-05-27 15:31:24.630 GCD_Demo[2540:25b] target queue in</span><br><span class="line">2016-05-27 15:31:28.634 GCD_Demo[2540:25b] target queue out</span><br><span class="line">2016-05-27 15:31:28.636 GCD_Demo[2540:25b] 1 in</span><br><span class="line">2016-05-27 15:31:31.640 GCD_Demo[2540:25b] 1 out</span><br><span class="line">2016-05-27 15:31:31.642 GCD_Demo[2540:25b] 2 in</span><br><span class="line">2016-05-27 15:31:33.645 GCD_Demo[2540:25b] 2 out</span><br><span class="line">2016-05-27 15:31:33.648 GCD_Demo[2540:25b] 3 in</span><br><span class="line">2016-05-27 15:31:34.651 GCD_Demo[2540:25b] 3 out</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šçš„ä»£ç ä¸­ï¼Œå¦‚æœå°†ï¼ˆæ ‡è®° 1ï¼‰å¤„çš„ <code>dispatch_set_target_queue</code> ä¸‰å¥ä»£ç æ³¨é‡Šæ‰ï¼Œåˆ™ä¼šå‡ºç°ä»¥ä¸‹ç»“æœï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">2016-05-27 14:34:40.245 GCD_Demo[1796:1403] target queue in</span><br><span class="line">2016-05-27 14:34:40.246 GCD_Demo[1796:21b] 1 in</span><br><span class="line">2016-05-27 14:34:40.247 GCD_Demo[1796:4203] 2 in</span><br><span class="line">2016-05-27 14:34:40.247 GCD_Demo[1796:4303] 3 in</span><br><span class="line">2016-05-27 14:34:41.253 GCD_Demo[1796:4303] 3 out</span><br><span class="line">2016-05-27 14:34:42.253 GCD_Demo[1796:4203] 2 out</span><br><span class="line">2016-05-27 14:34:43.249 GCD_Demo[1796:21b] 1 out</span><br><span class="line">2016-05-27 14:34:44.249 GCD_Demo[1796:1403] target queue out</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ­£å¦‚åœ¨ <a href="/2016/08/16/ã€ŠiOS ä¸ OS X å¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹è¯»ä¹¦ç¬”è®°ä¹‹ GCDï¼ˆä¸€ï¼‰/#dispatch-queue-create">dispatch_queue_create</a> å°èŠ‚ä¸­æ‰€è¯´çš„ï¼Œè™½ç„¶ queue1ã€queue2 å’Œ queue3 æ˜¯ä¸²è¡Œé˜Ÿåˆ—ï¼Œä½†ç”±äºå°†ä¸åŒçš„ 3 ä¸ª block åˆ†åˆ«è¿½åŠ åˆ°äº†è¿™ 3 ä¸ªä¸²è¡Œé˜Ÿåˆ—ä¸­ï¼Œæ‰€ä»¥è¿™ 3 ä¸ªä¸²è¡Œé˜Ÿåˆ—æ˜¯<code>åŒæ—¶å¤„ç†</code>çš„ã€‚</p>
</blockquote>
<hr>
<h2 id="dispatch-after"><a href="#dispatch-after" class="headerlink" title="dispatch_after"></a>dispatch_after</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">3</span> * <span class="built_in">NSEC_PER_SEC</span>));</span><br><span class="line">dispatch_after(time, dispatch_get_main_queue(), ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"waited at least three seconds."</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>æ³¨æ„ï¼šdispatch_after å‡½æ•°å¹¶ä¸æ˜¯åœ¨æŒ‡å®šæ—¶é—´åæ‰§è¡Œå¤„ç†ï¼Œè€Œåªæ˜¯åœ¨æŒ‡å®šæ—¶é—´è¿½åŠ å¤„ç†åˆ° Dispatch Queueã€‚æ­¤æºç ä¸åœ¨ 3 ç§’åç”¨ dispatch_async å‡½æ•°è¿½åŠ  Block åˆ° Main Dispatch Queue çš„ç›¸åŒã€‚</p>
</blockquote>
<p>ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šè¦è¿½åŠ å¤„ç†çš„ Dispatch Queueï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æŒ‡å®šè®°è¿°è¦æ‰§è¡Œå¤„ç†çš„ Blockã€‚</p>
<hr>
<h2 id="Dispatch-Group"><a href="#Dispatch-Group" class="headerlink" title="Dispatch Group"></a>Dispatch Group</h2><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)testDispatchGroup &#123;</span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">    dispatch_group_t group = dispatch_group_create();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//å°†é˜Ÿåˆ—æ·»åŠ è¿› group ä¸­</span></span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;<span class="built_in">NSLog</span>(<span class="string">@"blk0"</span>);&#125;);</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;<span class="built_in">NSLog</span>(<span class="string">@"blk1"</span>);&#125;);</span><br><span class="line">    dispatch_group_async(group, queue, ^&#123;<span class="built_in">NSLog</span>(<span class="string">@"blk2"</span>);&#125;);</span><br><span class="line">    </span><br><span class="line">    dispatch_group_notify(group, queue, ^&#123;<span class="built_in">NSLog</span>(<span class="string">@"done"</span>);&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ‰§è¡Œç»“æœå¦‚ä¸‹ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">blk0</span><br><span class="line">blk2</span><br><span class="line">blk1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<p><code>dispatch_group_notify</code> ï¼šç”¨æ¥ç›‘å¬é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡å·²å…¨éƒ¨æ‰§è¡Œå®Œæ¯•ï¼Œç¬¬ä¸‰ä¸ªå‚æ•° <code>block</code>ç”¨æ¥æ‰§è¡Œ group ä¸­ä»»åŠ¡å®Œæ¯•æ‰€å“åº”çš„æ“ä½œã€‚</p>
<p>å¦å¤–ï¼Œåœ¨ Dispatch Group ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨ <code>dispatch_group_wait</code> å‡½æ•°ä»…ç­‰å¾…å…¨éƒ¨å¤„ç†æ‰§è¡Œç»“æŸã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_group_wait(group, DISPATCH_TIME_FOREVER);<span class="comment">//ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šä¸ºç­‰å¾…çš„æ—¶é—´ï¼ˆè¶…æ—¶ï¼‰ï¼Œæ­¤å¤„æ„å‘³ç€æ°¸ä¹…ç­‰å¾…ã€‚**åªè¦å±äº Dispatch Group çš„å¤„ç†å°šæœªæ‰§è¡Œç»“æŸï¼Œå°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œä¸­é€”ä¸èƒ½å–æ¶ˆ**</span></span><br></pre></td></tr></table></figure>
<p>å¦‚æœæƒ³æŒ‡å®šç­‰å¾…æ—¶é—´é—´éš”ä¸º 1 ç§’æ—¶åº”åšå¦‚ä¸‹å¤„ç†ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">1</span> * <span class="built_in">NSEC_PER_SEC</span>));</span><br><span class="line"><span class="keyword">long</span> result = dispatch_group_wait(group, time);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="number">0</span> == result) &#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  å±äº Dispatch Group çš„å…¨éƒ¨å¤„ç†æ‰§è¡Œç»“æŸ</span><br><span class="line">     */</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">/**</span><br><span class="line">     *  å±äº Dispatch Group de æŸä¸€ä¸ªå¤„ç†è¿˜åœ¨æ‰§è¡Œä¸­</span><br><span class="line">     */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å½“ç­‰å¾…æ—¶é—´ä¸º DISPATCH_TIME_FOREVERã€ç”± dispatch_group_wait å‡½æ•°è¿”å›æ—¶ï¼Œç”±äºå±äº Dispatch Group çš„å¤„ç†å¿…å®šå…¨éƒ¨æ‰§è¡Œç»“æŸï¼Œæ‰€ä»¥è¿”å›å€¼æ’å®šä¸º 0.<br>è¿™é‡Œçš„â€œç­‰å¾…â€æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿè¿™æ„å‘³ç€ä¸€æ—¦è°ƒç”¨ dispatch_group_wait å‡½æ•°ï¼Œè¯¥å‡½æ•°å°±å¤„äºè°ƒç”¨çš„çŠ¶æ€è€Œä¸è¿”å›ã€‚å³æ‰§è¡Œ dispatch_group_wait å‡½æ•°çš„ç°åœ¨çš„çº¿ç¨‹ï¼ˆå½“å‰çº¿ç¨‹ï¼‰åœæ­¢ã€‚åœ¨ç»è¿‡ dispatch_group_wait å‡½æ•°ä¸­æŒ‡å®šçš„æ—¶é—´æˆ–å±äºæŒ‡å®š Dispatch Queue çš„å¤„ç†å…¨éƒ¨æ‰§è¡Œç»“æŸå‰ï¼Œæ‰§è¡Œè¯¥å‡½æ•°çš„çº¿ç¨‹åœæ­¢ã€‚</p>
</blockquote>
<p>æŒ‡å®š DISPATCH_TIME_NOWï¼Œåˆ™ä¸ç”¨ä»»ä½•ç­‰å¾…å³å¯åˆ¤å®šå±äº Dispatch Group çš„å¤„ç†æ˜¯å¦æ‰§è¡Œç»“æŸã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">long</span> result = dispatch_group_wait(group, DISPATCH_TIME_NOW);</span><br></pre></td></tr></table></figure>
<p>åœ¨ä¸»çº¿ç¨‹çš„ RunLoop çš„æ¯æ¬¡å¾ªç¯ä¸­ï¼Œå¯æ£€æŸ¥æ‰§è¡Œæ˜¯å¦ç»“æŸï¼Œä»è€Œä¸è€—è´¹å¤šä½™çš„ç­‰å¾…æ—¶é—´ï¼Œè™½ç„¶è¿™æ ·ä¹Ÿå¯ä»¥ï¼Œä½†ä¸€èˆ¬åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿˜æ˜¯æ¨èç”¨ <code>dispatch_group_notify</code> å‡½æ•°è¿½åŠ ç»“æŸå¤„ç†åˆ° Main Dispatch Queue ä¸­ã€‚è¿™æ˜¯å› ä¸º <code>dispatch_group_notify</code> å‡½æ•°å¯ä»¥ç®€åŒ–æºä»£ç ã€‚</p>
<hr>
<h2 id="dispatch-barrier-async"><a href="#dispatch-barrier-async" class="headerlink" title="dispatch_barrier_async"></a>dispatch_barrier_async</h2><p>ä¸¾ä¾‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)testDispatchBarrierAsync &#123;</span><br><span class="line">	<span class="comment">// åˆ›å»ºå¹¶è¡Œé˜Ÿåˆ—</span></span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"com.gcd.ForBarrier"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¼‚æ­¥æ‰§è¡Œå¹¶è¡Œé˜Ÿåˆ—</span></span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blk0_for_reading"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blk1_for_reading"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blk2_for_reading"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blk3_for_reading"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">	</span><br><span class="line">    <span class="comment">// æ­¤å¤„ä¼šç­‰å¾…å·²ç»è¿½åŠ åˆ° concurrentQueue ä¸­çš„ block æ“ä½œå…¨éƒ¨æ‰§è¡Œå®Œæˆï¼Œ</span></span><br><span class="line">    <span class="comment">// å†è°ƒç”¨ dispatch_barrier_async å‡½æ•°ã€‚</span></span><br><span class="line">    dispatch_barrier_async(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blk_for_writting"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ç»§ç»­å¼‚æ­¥æ‰§è¡Œå¹¶è¡Œé˜Ÿåˆ—</span></span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blk4_for_reading"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blk5_for_reading"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blk6_for_reading"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"blk7_for_reading"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>dispatch_barrier_async å‡½æ•°ä¼šç­‰å¾…è¿½åŠ åˆ° Concurrent Dispatch Queue ä¸Šçš„å¹¶è¡Œæ‰§è¡Œçš„å¤„ç†å…¨éƒ¨ç»“æŸä¹‹åï¼Œå†å°†æŒ‡å®šçš„å¤„ç†è¿½åŠ åˆ°è¯¥ Concurrent Dispatch Queue ä¸­ã€‚ç„¶åå†ç”± dispatch_barrier_async å‡½æ•°è¿½åŠ çš„å¤„ç†æ‰§è¡Œå®Œæ¯•åï¼ŒConcurrent Dispatch Queue æ‰æ¢å¤ä¸ºä¸€èˆ¬çš„åŠ¨ä½œï¼Œè¿½åŠ åˆ°è¯¥ Concurrent Dispatch Queue çš„å¤„ç†åˆå¼€å§‹å¹¶è¡Œæ‰§è¡Œã€‚</p>
</blockquote>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">2016-05-27 16:12:41.103 GCD_Demo[2540:4507] blk1_for_reading</span><br><span class="line">2016-05-27 16:12:41.102 GCD_Demo[2540:43d7] blk0_for_reading</span><br><span class="line">2016-05-27 16:12:41.105 GCD_Demo[2540:43d7] blk3_for_reading</span><br><span class="line">2016-05-27 16:12:41.106 GCD_Demo[2540:4507] blk2_for_reading</span><br><span class="line">2016-05-27 16:12:41.108 GCD_Demo[2540:43d7] blk_for_writting //&lt;--</span><br><span class="line">2016-05-27 16:12:41.109 GCD_Demo[2540:43d7] blk4_for_reading</span><br><span class="line">2016-05-27 16:12:41.112 GCD_Demo[2540:43d7] blk6_for_reading</span><br><span class="line">2016-05-27 16:12:41.109 GCD_Demo[2540:4507] blk5_for_reading</span><br><span class="line">2016-05-27 16:12:41.113 GCD_Demo[2540:43d7] blk7_for_reading</span><br></pre></td></tr></table></figure>
<p><em>ä½¿ç”¨ Concurrent Dispatch Queue å’Œ dispatch_barrier_async å‡½æ•°å¯å®ç° é«˜æ•ˆç‡ çš„æ•°æ®åº“è®¿é—®å’Œæ–‡ä»¶è®¿é—®ã€‚</em></p>
<hr>
<h2 id="dispatch-sync-amp-æ­»é”é—®é¢˜"><a href="#dispatch-sync-amp-æ­»é”é—®é¢˜" class="headerlink" title="dispatch_sync &amp; æ­»é”é—®é¢˜"></a>dispatch_sync &amp; æ­»é”é—®é¢˜</h2><blockquote>
<p>æ—¢ç„¶æœ‰â€œasyncâ€ï¼Œå½“ç„¶ä¹Ÿæœ‰â€œsyncâ€ï¼Œå³ <code>dispatch_sync</code> å‡½æ•°ã€‚å®ƒæ„å‘³ç€â€œåŒæ­¥â€ï¼ˆsynchonousï¼‰ï¼Œä¹Ÿå°±æ˜¯å°†æŒ‡å®šçš„ Block â€œåŒæ­¥â€è¿½åŠ åˆ°åˆ¶å®šçš„ Dispatch Queue ä¸­ã€‚åœ¨è¿½åŠ  Block æ‰§è¡Œç»“æŸä¹‹å‰ï¼Œdispatch_sync å‡½æ•°ä¼šä¸€ç›´ç­‰å¾…ã€‚<br><strong>â€œç­‰å¾…â€ æ„å‘³ç€ <code>å½“å‰çº¿ç¨‹åœæ­¢</code>ã€‚</strong></p>
</blockquote>
<p>ä¸€æ—¦è°ƒç”¨ dispatch_sync å‡½æ•°ï¼Œé‚£ä¹ˆåœ¨åˆ¶å®šçš„å¤„ç†æ‰§è¡Œç»“æŸä¹‹å‰ï¼Œè¯¥å‡½æ•°ä¸ä¼šè¿”å›ã€‚</p>
<h3 id="æ­»é”é—®é¢˜"><a href="#æ­»é”é—®é¢˜" class="headerlink" title="æ­»é”é—®é¢˜"></a>æ­»é”é—®é¢˜</h3><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main_queue();</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;<span class="built_in">NSLog</span>@(<span class="string">@"Hello?"</span>);&#125;);   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¯¥æºä»£ç åœ¨ Main Dispatch Queue å³ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œåˆ¶å®š Blockï¼Œå¹¶ç­‰å¾…å…¶æ‰§è¡Œç»“æŸã€‚è€Œå…¶å®ä¸»çº¿ç¨‹æ­£åœ¨æ‰§è¡Œ <code>è¿™äº›æºä»£ç </code>ï¼Œæ‰€ä»¥ <code>æ— æ³•æ‰§è¡Œ</code> è¿½åŠ åˆ° Main Dispatch Queue ä¸­çš„ Blockã€‚ä¸‹é¢çš„ä¾‹å­ä¹Ÿä¸€æ ·ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> queue = dispatch_get_main();</span><br><span class="line">    <span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">        <span class="built_in">dispatch_sync</span>(queue, ^&#123;<span class="built_in">NSLog</span>(<span class="string">@"Hello?"</span>);&#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆå¼‚æ­¥åœ°å‘ä¸²è¡Œé˜Ÿåˆ—ï¼ˆmain queueï¼‰ä¸­è¿½åŠ ä¸€ä¸ª block1ï¼Œåœ¨è¿™ä¸ª block1 ä¸­åˆåŒæ­¥åœ°å‘æ­¤ä¸²è¡Œé˜Ÿåˆ—ï¼ˆmain queueï¼‰è¿½åŠ ä¸€ä¸ª block2ã€‚æ‰€ä»¥æŒ‰ç…§ä¸²è¡Œé˜Ÿåˆ—çš„å·¥ä½œåŸç†ï¼Œéœ€è¦ç­‰ block1 æ‰§è¡Œå®Œæ¯•ï¼Œæ‰ä¼šæ‰§è¡Œ block2ï¼Œè€Œ block1 æ‰§è¡Œçš„å†…å®¹ï¼Œå°±æ˜¯åœ¨åŒæ ·çš„ä¸²è¡Œé˜Ÿåˆ—ä¸­åŒæ­¥æ‰§è¡Œ block2ï¼Œblock2 åˆéœ€è¦ç­‰å¾… block1 æ‰§è¡Œå®Œæ¯•ä¹‹åå†æ‰§è¡Œã€‚æ‰€ä»¥æ­¤å¤„å½¢æˆäº†ä¸€ä¸ªäº’ç›¸ç­‰å¾…çš„æƒ…å†µï¼Œé€ æˆ<code>æ­»é”</code>ã€‚<br>æ­¤å¤„çš„ dispatch_async å‡½æ•°ä¼šè¿”å›ï¼Œè€Œ dispatch_sync æ°¸è¿œä¸ä¼šè¿”å›ã€‚</p>
<p>Serial Dispatch Queue ä¹Ÿä¼šå¼•èµ·ç›¸åŒçš„é—®é¢˜ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_queue_create(<span class="string">"com.gcd.serialDispatchQueue"</span>, <span class="literal">NULL</span>);</span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">    <span class="built_in">dispatch_sync</span>(queue, ^&#123;<span class="built_in">NSLog</span>(<span class="string">@"Hello?"</span>);&#125;);<span class="comment">// æ— æ³•è¾“å‡º â€œHello?â€</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="dispatch-apply"><a href="#dispatch-apply" class="headerlink" title="dispatch_apply"></a>dispatch_apply</h2><p>dispatch_apply å‡½æ•°æ˜¯ dispatch_sync å‡½æ•°å’Œ Dispatch Group çš„å…³è” APIã€‚è¯¥å‡½æ•°æŒ‰æŒ‡å®šçš„æ¬¡æ•°å°†æŒ‡å®šçš„ Block è¿½åŠ åˆ°æŒ‡å®šçš„ Dispatch Queue ä¸­ï¼Œå¹¶ç­‰å¾…å…¨éƒ¨å¤„ç†æ‰§è¡Œç»“æŸã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_queue_t</span> queue= dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>);</span><br><span class="line">dispatch_apply(<span class="number">3</span>, queue, ^(size_t index) &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%zu"</span>, index);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"done"</span>);</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">done</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ç”±äº dispatch_apply å‡½æ•°ä¹Ÿä¸ dispatch_sync å‡½æ•°ç›¸åŒï¼Œä¼šç­‰å¾…å¤„ç†æ‰§è¡Œç»“æŸï¼Œå› æ­¤æ¨èåœ¨ <code>dispatch_async</code> å‡½æ•°ä¸­ <strong>éåŒæ­¥</strong> åœ°æ‰§è¡Œ dispatch_apply å‡½æ•°ã€‚</p>
</blockquote>
<hr>
<h2 id="dispatch-suspend-dispatch-resume"><a href="#dispatch-suspend-dispatch-resume" class="headerlink" title="dispatch_suspend / dispatch_resume"></a>dispatch_suspend / dispatch_resume</h2><p>æŒ‚èµ·æŒ‡å®šçš„ queueï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_suspend(queue);</span><br></pre></td></tr></table></figure>
<p>æ¢å¤æŒ‡å®šçš„ queueï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_resume(queue);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è¿™äº›å‡½æ•°å¯¹å·²ç»æ‰§è¡Œçš„å¤„ç†æ²¡æœ‰å½±å“ã€‚æŒ‚èµ·åï¼Œè¿½åŠ åˆ° Dispatch Queue ä¸­ä½†å°šæœªæ‰§è¡Œçš„å¤„ç†åœ¨æ­¤ä¹‹ååœæ­¢æ‰§è¡Œã€‚è€Œæ¢å¤åˆ™ä½¿å¾—è¿™äº›å¤„ç†èƒ½å¤Ÿç»§ç»­æ‰§è¡Œã€‚</p>
</blockquote>
<hr>
<h2 id="Dispatch-Semaphore"><a href="#Dispatch-Semaphore" class="headerlink" title="Dispatch Semaphore"></a>Dispatch Semaphore</h2><p>Dispatch Semaphore æ˜¯æŒæœ‰è®¡æ•°çš„ä¿¡å·ï¼Œè¯¥è®¡æ•°æ˜¯å¤šçº¿ç¨‹ç¼–ç¨‹ä¸­çš„è®¡æ•°ç±»å‹ä¿¡å·ã€‚æ‰€è°“ä¿¡å·ï¼Œç±»ä¼¼äºè¿‡é©¬è·¯æ—¶å¸¸ç”¨çš„æ‰‹æ——ã€‚å¯ä»¥é€šè¿‡æ—¶ä¸¾èµ·æ‰‹æ——ï¼Œä¸å¯é€šè¿‡æ—¶æ”¾ä¸‹æ‰‹æ——ã€‚è€Œåœ¨ Dispatch Semaphore ä¸­ï¼Œä½¿ç”¨è®¡æ•°æ¥å®ç°è¯¥åŠŸèƒ½ã€‚è®¡æ•°ä¸º 0 æ—¶ç­‰å¾…ï¼Œè®¡æ•°ä¸º 1 æˆ–å¤§äº 1 æ—¶ã€‚å‡å» 1 è€Œä¸ç­‰å¾…ã€‚</p>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class="number">1</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>å‚æ•°è¡¨ç¤ºè®¡æ•°çš„åˆå§‹å€¼ã€‚ä¾‹å­ä¸­å°†è®¡æ•°å€¼åˆå§‹åŒ–ä¸º 1ã€‚</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br></pre></td></tr></table></figure>
<p>dispatch_semaphore_wait å‡½æ•°ç­‰å¾… Dispatch Semaphore çš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºæˆ–ç­‰äº 1.å½“è®¡æ•°å€¼å¤§äºç­‰äº 1ï¼Œæˆ–è€…åœ¨å¾…æœºä¸­è®¡æ•°å€¼å¤§äºç­‰äº 1 æ—¶ï¼Œå¯¹è¯¥è®¡æ•°è¿›è¡Œå‡æ³•å¹¶ä» dispatch_semaphore_wait å‡½æ•°è¿”å›ã€‚ç¬¬äºŒä¸ªå‡½æ•°æŒ‡å®šç­‰å¾…æ—¶é—´ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">dispatch_time_t time = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">1</span> * <span class="built_in">NSEC_PER_SEC</span>));</span><br><span class="line"><span class="keyword">long</span> result = dispatch_semaphore_wait(semaphore, time);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="number">0</span> == result) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     * ç”±äº Dispatch Semaphore çš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºç­‰äº 1</span><br><span class="line">     * æˆ–è€…åœ¨å¾…æœºä¸­çš„æŒ‡å®šæ—¶é—´å†…</span><br><span class="line">     * Dispatch Semaphore çš„è®¡æ•°å€¼è¾¾åˆ°å¤§äºç­‰äº 1</span><br><span class="line">     * æ‰€ä»¥ Dispatch Semaphore çš„è®¡æ•°å€¼å‡å» 1</span><br><span class="line">     *</span><br><span class="line">     * å¯æ‰§è¡Œéœ€è¦è¿›è¡Œæ’ä»–æ§åˆ¶çš„é”¤ç‚¼</span><br><span class="line">     */</span></span><br><span class="line">     </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     * ç”±äº Dispatch Semaphore çš„è®¡æ•°å€¼ä¸º 0</span><br><span class="line">     * å› æ­¤åœ¨è¾¾åˆ°æŒ‡å®šæ—¶é—´ä¸ºæ­¢å¾…æœº</span><br><span class="line">     */</span></span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>dispatch_semaphore_wait å‡½æ•°è¿”å› 0 æ—¶ï¼Œå¯å®‰å…¨åœ°æ‰§è¡Œéœ€è¦è¿›è¡Œæ’ä»–æ§åˆ¶çš„å¤„ç†ã€‚<br>è¯¥å¤„ç†ç»“æŸæ—¶ <strong><code>é€šè¿‡ dispatch_semaphore_signal å‡½æ•°å°† Dispatch Semaphore çš„è®¡æ•°å€¼åŠ  1</code></strong>.</p>
<p>Sample:</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)testDispatchSemaphore &#123;</span><br><span class="line">	<span class="comment">//åˆ›å»ºä¸€ä¸ª semaphore</span></span><br><span class="line">    dispatch_semaphore_t semaphore = dispatch_semaphore_create(<span class="number">1</span>);</span><br><span class="line">    </span><br><span class="line">    __block <span class="built_in">NSString</span> *strTest = <span class="string">@"test"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">dispatch_queue_t</span> concurrentQueue = dispatch_queue_create(<span class="string">"com.gcd.concurrentQueue"</span>, DISPATCH_QUEUE_CONCURRENT);</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">    	</span><br><span class="line">    	<span class="comment">//æ¯æ¬¡æ‰§è¡Œä¹‹å‰ï¼Œå…ˆåˆ¤å®šä¿¡å·é‡æ˜¯å¦å¤§äº 0ï¼Œæ˜¯çš„è¯å°±æ‰§è¡Œï¼Œå¦åˆ™ç­‰å¾…ã€‚</span></span><br><span class="line">        dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ([strTest isEqualToString:<span class="string">@"test"</span>]) &#123;</span><br><span class="line">        </span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"--%@--1--"</span>, strTest);</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> ([strTest isEqualToString:<span class="string">@"test"</span>]) &#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"--%@--2--"</span>, strTest);</span><br><span class="line">                [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];                </span><br><span class="line">            &#125; <span class="keyword">else</span>  &#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"==========changed========"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œä¿¡å·é‡è¿›è¡Œ +1 å¤„ç†</span></span><br><span class="line">        dispatch_semaphore_signal(semaphore);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line">    </span><br><span class="line">        dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"--%@--3--"</span>, strTest);</span><br><span class="line">        </span><br><span class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line">        dispatch_semaphore_signal(semaphore);</span><br><span class="line">        </span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line"></span><br><span class="line">        dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line"></span><br><span class="line">        strTest = <span class="string">@"modify"</span>;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"--%@--4--"</span>, strTest);</span><br><span class="line"></span><br><span class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line">        dispatch_semaphore_signal(semaphore);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="built_in">dispatch_async</span>(concurrentQueue, ^&#123;</span><br><span class="line"></span><br><span class="line">        dispatch_semaphore_wait(semaphore, DISPATCH_TIME_FOREVER);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"--%@--5--"</span>, strTest);</span><br><span class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">        dispatch_semaphore_signal(semaphore);</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">2016-05-27 17:15:39.490 GCD_Demo[2540:4717] --test--1--</span><br><span class="line">2016-05-27 17:15:40.494 GCD_Demo[2540:4717] --test--2--</span><br><span class="line">2016-05-27 17:15:41.498 GCD_Demo[2540:4517] --test--3--</span><br><span class="line">2016-05-27 17:15:42.502 GCD_Demo[2540:442f] --modify--4--</span><br><span class="line">2016-05-27 17:15:43.505 GCD_Demo[2540:4283] --modify--5--</span><br></pre></td></tr></table></figure>
<blockquote>
<p>è§£æï¼šä»¥ä¸Šè™½ç„¶ Block éƒ½æ˜¯åœ¨å¼‚æ­¥é˜Ÿåˆ—ä¸­æ‰§è¡Œï¼Œä½†æ˜¯ç”±äºåˆå§‹åŒ– Semaphore æ—¶æ˜¯ä»¥ 1 çš„ä¿¡å·é‡åˆ›å»ºçš„ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ª Block åœ¨è¿½åŠ åˆ°å¼‚æ­¥é˜Ÿåˆ—ä¸­ä¹‹åï¼Œç”±äºæ‰§è¡Œä¹‹å‰éƒ½é€šè¿‡äº†ä¿¡å·é‡çš„åˆ¤æ–­ï¼Œæ‰€ä»¥åŒæ—¶åªæœ‰ä¸€ä¸ª Block èƒ½å¤Ÿæ‰§è¡Œã€‚ç›´åˆ°ä¸€ä¸ª Block æ‰§è¡Œå®Œæ¯•ï¼Œæ¢å¤äº†ä¿¡å·é‡ä¹‹åï¼Œä¸‹ä¸€ä¸ª Block æ‰èƒ½å¾—ä»¥æ‰§è¡Œã€‚</p>
</blockquote>
<hr>
<h2 id="dispatch-once"><a href="#dispatch-once" class="headerlink" title="dispatch_once"></a>dispatch_once</h2><p>dispatch_once å‡½æ•°æ˜¯ä¿è¯åœ¨åº”ç”¨ç¨‹åºæ‰§è¡Œä¸­åªæ‰§è¡Œä¸€æ¬¡æŒ‡å®šå¤„ç†çš„APIã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> pred;</span><br><span class="line"><span class="built_in">dispatch_once</span>(&amp;pred, ^&#123;</span><br><span class="line">    <span class="comment">//åˆå§‹åŒ–</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p><strong>å•ä¾‹æ¨¡å¼</strong>ï¼Œæ­¤æºä»£ç èƒ½å¤Ÿä¿è¯å³ä½¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ‰§è¡Œï¼Œä¹Ÿæ˜¯ç™¾åˆ†ä¹‹ç™¾å®‰å…¨ã€‚</p>
</blockquote>
<hr>
<h2 id="Dispatch-I-O"><a href="#Dispatch-I-O" class="headerlink" title="Dispatch I/O"></a>Dispatch I/O</h2><p>ï¼ˆå¾…å®Œå–„ï¼‰</p>
<hr>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ã€ŠiOS ä¸ OS X å¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†ã€‹è¯»ä¹¦ç¬”è®°ä¹‹ GCDï¼ˆä¸€ï¼‰]]></title>
      <url>http://raykle.coding.me/2016/08/16/%E3%80%8AiOS%20%E4%B8%8E%20OS%20X%20%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0%E4%B9%8B%20GCD%EF%BC%88%E4%B8%80%EF%BC%89/</url>
      <content type="html"><![CDATA[<blockquote class="blockquote-center"><p>ä¹¦ç±é“¾æ¥ï¼š<a href="https://www.amazon.cn/Objective-C%E9%AB%98%E7%BA%A7%E7%BC%96%E7%A8%8B-iOS%E4%B8%8EOS-X%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86-%E5%9D%82%E6%9C%AC%E4%B8%80%E6%A0%91/dp/B00DE60G3S/ref=sr_1_1?ie=UTF8&amp;qid=1471501826&amp;sr=8-1&amp;keywords=iOS+%E4%B8%8E+OS+X+%E5%A4%9A%E7%BA%BF%E7%A8%8B%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86" target="_blank" rel="external">Objective-C é«˜çº§ç¼–ç¨‹: iOS ä¸ OS X å¤šçº¿ç¨‹å’Œå†…å­˜ç®¡ç†</a></p>
</blockquote>
<h2 id="å‡ ä¸ªæ¦‚å¿µ"><a href="#å‡ ä¸ªæ¦‚å¿µ" class="headerlink" title="å‡ ä¸ªæ¦‚å¿µ"></a>å‡ ä¸ªæ¦‚å¿µ</h2><p><code>å¼‚æ­¥</code>ï¼šæäº¤ä»»åŠ¡ä¹‹åç«‹åˆ»è¿”å›ï¼Œåœ¨åå°é˜Ÿåˆ—ä¸­æ‰§è¡Œä»»åŠ¡ã€‚<br><code>åŒæ­¥</code>ï¼šæäº¤çš„ä»»åŠ¡æ‰§è¡Œå®Œä¹‹åï¼Œå†è¿”å›ã€‚</p>
<p><code>å¹¶è¡Œæ‰§è¡Œ</code>ï¼šæäº¤åˆ°ä»»åŠ¡åˆ°é˜Ÿåˆ—ä¸­ä¹‹åï¼Œæ¯”å¦‚æŒ‰é¡ºåºæäº¤äº†ä»»åŠ¡ 1 å’Œä»»åŠ¡ 2ï¼Œåœ¨ä»»åŠ¡ 1 å¼€å§‹æ‰§è¡Œä¹‹åï¼Œä¸ç®¡ä»»åŠ¡ 1 æœ‰æ²¡æœ‰æ‰§è¡Œå®Œæ¯•ï¼Œéƒ½å¼€å§‹æ‰§è¡Œä»»åŠ¡ 2ã€‚<br><code>ä¸²è¡Œæ‰§è¡Œ</code>ï¼šæäº¤åˆ°ä»»åŠ¡åˆ°é˜Ÿåˆ—ä¸­ä¹‹åï¼Œæ¯”å¦‚æŒ‰é¡ºåºæäº¤äº†ä»»åŠ¡ 1 å’Œä»»åŠ¡ 2ï¼Œåªæœ‰åœ¨ä»»åŠ¡ 1 æ‰§è¡Œå®Œæ¯•ä¹‹åï¼Œæ‰æ‰§è¡Œä»»åŠ¡ 2ã€‚</p>
<blockquote>
<p>å¼‚æ­¥ or åŒæ­¥ï¼Œç”±å‡½æ•° <code>dispatch_syncï¼ˆåŒæ­¥ï¼‰</code> or <code>dispatch_asyncï¼ˆå¼‚æ­¥ï¼‰</code> å†³å®šã€‚<br>å¹¶è¡Œ or ä¸²è¡Œï¼Œç”±é˜Ÿåˆ—æœ¬èº«å†³å®šã€‚å¦‚æ·»åŠ ä»»åŠ¡åˆ° <code>Serial Dispatch Queueï¼ˆä¸²è¡Œé˜Ÿåˆ—ï¼‰</code> or <code>Concurrent Dispatch Queueï¼ˆå¹¶è¡Œé˜Ÿåˆ—ï¼‰</code> é˜Ÿåˆ—ä¸­ã€‚</p>
</blockquote>
<hr>
<h2 id="Dispatch-Queue"><a href="#Dispatch-Queue" class="headerlink" title="Dispatch Queue"></a>Dispatch Queue</h2><blockquote>
<p>å¼€å‘è€…è¦åšçš„åªæ˜¯å®šä¹‰æƒ³æ‰§è¡Œçš„ä»»åŠ¡å¹¶è¿½åŠ åˆ°é€‚å½“çš„ Dispatch Queue ä¸­ã€‚</p>
</blockquote>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">    <span class="comment">//æƒ³è¦æ‰§è¡Œçš„ä»»åŠ¡</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è¯¥æºä»£ç ä½¿ç”¨ Block è¯­æ³•â€œå®šä¹‰æƒ³æ‰§è¡Œçš„ä»»åŠ¡â€ï¼Œé€šè¿‡ dispatch_async å‡½æ•°â€œè¿½åŠ â€èµ‹å€¼åœ¨å˜é‡ queue çš„â€œDispatch Queue ä¸­â€ã€‚ä»…è¿™æ ·å°±å¯ä½¿æŒ‡å®šçš„ Block åœ¨å¦ä¸€çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p>
<p>â€œDispatch Queueâ€æ˜¯æ‰§è¡Œå¤„ç†çš„ç­‰å¾…é˜Ÿåˆ—ã€‚åº”ç”¨ç¨‹åºç¼–å†™äººå‘˜é€šè¿‡ dispatch_async å‡½æ•°ç­‰ APIï¼Œåœ¨ Block è¯­æ³•ä¸­è®°è¿°æƒ³æ‰§è¡Œçš„å¤„ç†å¹¶å°†å…¶è¿½åŠ åˆ° Dispatch Queue ä¸­ã€‚Dispatch Queue æŒ‰ç…§è¿½åŠ çš„é¡ºåºï¼ˆ<strong><code>å…ˆè¿›å…ˆå‡º FIFO</code></strong>ï¼‰æ‰§è¡Œå¤„ç†ã€‚</p>
<hr>
<h2 id="Dispatch-Queue-ç§ç±»"><a href="#Dispatch-Queue-ç§ç±»" class="headerlink" title="Dispatch Queue ç§ç±»"></a>Dispatch Queue ç§ç±»</h2><p><code>Serial Dispatch Queue</code> ç­‰å¾…ç°åœ¨æ‰§è¡Œä¸­å¤„ç†ç»“æœï¼Œä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ã€‚<br><code>Concurrent Dispatch Queue</code> ä¸ç­‰å¾…ç°åœ¨æ‰§è¡Œä¸­å¤„ç†ç»“æœï¼Œä½¿ç”¨å¤šä¸ªçº¿ç¨‹</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸€ä¸ª Serial Dispatch Queue</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> serialQueue = dispatch_queue_create(<span class="string">"come.iBinaryOrg.serial"</span>, DISPATCH_QUEUE_SERIAL);</span><br><span class="line"></span><br><span class="line"><span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"block 0"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"block 1"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"block 2"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">dispatch_async</span>(serialQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"block 3"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>å½“å˜é‡ä¸º Serial Dispatch Queue æ—¶ï¼Œå› ä¸ºè¦ç­‰å¾…ç°åœ¨æ‰§è¡Œä¸­çš„å¤„ç†ç»“æŸï¼Œæ‰€ä»¥é¦–å…ˆæ‰§è¡Œ blk0ï¼Œblk0 æ‰§è¡Œç»“æŸåï¼Œæ¥ç€æ‰§è¡Œ blk1ï¼Œblk1 ç»“æŸåå†å¼€å§‹æ‰§è¡Œ blk2ï¼Œå¦‚æ­¤é‡å¤ã€‚åŒæ—¶æ‰§è¡Œçš„å¤„ç†æ•°åªèƒ½æœ‰ 1 ä¸ªã€‚å³æ‰§è¡Œè¯¥æºç åï¼Œä¸€å®šæŒ‰ç…§ä»¥ä¸‹é¡ºåºè¿›è¡Œå¤„ç†ï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">block 0</span><br><span class="line">block 1</span><br><span class="line">block 2</span><br><span class="line">block 3</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>å½“å˜é‡ queue ä¸º Concurrent Dispatch Queue æ—¶ï¼Œå› ä¸ºä¸ç”¨ç­‰å¾…ç°åœ¨æ‰§è¡Œä¸­çš„å¤„ç†ç»“æœç»“æŸï¼Œæ‰€ä»¥é¦–å…ˆæ‰§è¡Œ blk0ï¼Œä¸ç®¡ blk0 çš„æ‰§è¡Œæ˜¯å¦ç»“æŸï¼Œéƒ½å¼€å§‹æ‰§è¡Œåé¢çš„ blk1ï¼Œä¸ç®¡ blk1 çš„æ‰§è¡Œæ˜¯å¦ç»“æŸï¼Œéƒ½å¼€å§‹æ‰§è¡Œåé¢çš„ blk2ï¼Œå¦‚æ­¤é‡å¤å¾ªç¯ã€‚</p>
<p>è¿™æ ·è™½ç„¶ä¸ç”¨ç­‰å¾…å¤„ç†ç»“æœï¼Œå¯ä»¥å¹¶è¡Œæ‰§è¡Œå¤šä¸ªå¤„ç†ï¼Œä½†å¹¶è¡Œæ‰§è¡Œçš„å¤„ç†æ•°é‡å–å†³äº<code>å½“å‰ç³»ç»Ÿçš„çŠ¶æ€</code>ã€‚å³ iOS å’Œ OS X åŸºäº Dispatch Queue ä¸­çš„å¤„ç†æ•°ã€CPU æ ¸æ•°ä»¥åŠ CPU è´Ÿè·ç­‰å½“å‰ç³»ç»Ÿçš„çŠ¶æ€æ¥å†³å®š Concurrent Dispatch Queue ä¸­å¹¶è¡Œæ‰§è¡Œçš„å¤„ç†æ•°ã€‚æ‰€è°“â€œå¹¶è¡Œæ‰§è¡Œâ€ï¼Œå°±æ˜¯ä½¿ç”¨å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå¤šä¸ªå¤„ç†ã€‚</p>
<hr>
<h2 id="dispatch-queue-create"><a href="#dispatch-queue-create" class="headerlink" title="dispatch_queue_create"></a>dispatch_queue_create</h2><p>å…³äº Serial Dispatch Queue ç”Ÿæˆä¸ªæ•°çš„æ³¨æ„äº‹é¡¹ï¼š</p>
<ul>
<li>ä½¿ç”¨ dispatch_queue_create å‡½æ•°å¯ç”Ÿæˆä»»æ„å¤šä¸ª Dispatch Queueï¼Œå½“ç”Ÿæˆå¤šä¸ª Serial Dispatch Queue æ—¶ï¼Œå„ä¸ª Serial Dispatch Queue å°† <strong><em>å¹¶è¡Œæ‰§è¡Œ</em></strong>ã€‚è™½ç„¶åœ¨ä¸€ä¸ª Serial Dispatch Queue ä¸­åŒæ—¶åªèƒ½æ‰§è¡Œä¸€ä¸ªè¿½åŠ å¤„ç†ï¼Œä½†å¦‚æœå°†å¤„ç†åˆ†åˆ«è¿½åŠ åˆ°4ä¸ª Serial Dispatch Queue ä¸­ï¼Œå„ä¸ª Serial Dispatch Queue æ‰§è¡Œä¸€ä¸ªï¼Œå³ä¸º <strong><em>åŒæ—¶æ‰§è¡Œ4ä¸ªå¤„ç†</em></strong>ã€‚</li>
<li>ä¸€æ—¦ç”Ÿæˆ Serial Dispatch Queue å¹¶è¿½åŠ å¤„ç†ï¼Œç³»ç»Ÿå¯¹äºä¸€ä¸ª Serial Dispatch Queue å°±åªç”Ÿæˆå¹¶ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹ã€‚å¦‚æœç”Ÿæˆ 2000 ä¸ª Serial Dispatch Queueï¼Œé‚£ä¹ˆå°±ç”Ÿæˆ 2000 ä¸ªçº¿ç¨‹ã€‚<em>è¿‡å¤šä½¿ç”¨å¤šçº¿ç¨‹ï¼Œå°±ä¼šæ¶ˆè€—å¤§é‡å†…å­˜ï¼Œå¼•èµ·å¤§é‡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œå¤§å¹…åº¦é™ä½ç³»ç»Ÿçš„å“åº”æ€§èƒ½ã€‚</em></li>
</ul>
<p>ä½¿ç”¨æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Serial Dispatch Queue</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> mySerialDispatchQueue = dispatch_queue_create(<span class="string">"com.iBinaryOrg.gcd.MySerialDispatchQueue"</span>, <span class="literal">NULL</span><span class="comment">/* ç­‰åŒäº DISPATCH_QUEUE_SERIALï¼Œä¸²è¡Œé˜Ÿåˆ— */</span>)ï¼›</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(mySerialDispatchQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Blk on mySerialDispatchQueue"</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//Concurrent Dispatch Queue</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> myConcurrentDispatchQueue = dispatch_queue_create(<span class="string">"com.iBinaryOrg.gcd.MyConcurrentDispatchQueue"</span>, DISPATCH_QUEUE_CONCURRENT)ï¼›<span class="comment">// å¹¶è¡Œé˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¼‚æ­¥æ‰§è¡Œ</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(myConcurrentDispatchQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"Blk on myConcurrentDispatchQueue"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<hr>
<h2 id="Main-Dispatch-Queue-Global-Dispatch-Queue"><a href="#Main-Dispatch-Queue-Global-Dispatch-Queue" class="headerlink" title="Main Dispatch Queue / Global Dispatch Queue"></a>Main Dispatch Queue / Global Dispatch Queue</h2><blockquote>
<p>Main Dispatch Queue æ˜¯ Serial Dispatch Queueã€‚<br>Global Dispatch Queue æ˜¯ Concurrent Dispatch Queueã€‚  </p>
</blockquote>
<p><strong>ç³»ç»Ÿæä¾›çš„ Dispatch Queue ç§ç±»ï¼š</strong></p>
<table>
<thead>
<tr>
<th>åç§°</th>
<th>Dispatch Queue ç§ç±»</th>
<th>è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td>Main Dispatch Queue</td>
<td>Serial DIspatch Queue</td>
<td>ä¸»çº¿ç¨‹æ‰§è¡Œ</td>
</tr>
<tr>
<td>Serial Dispatch Queue (Hign Priority)</td>
<td>Concurrent Dispatch Queue</td>
<td>æ‰§è¡Œä¼˜å…ˆçº§ï¼šé«˜ (æœ€é«˜ä¼˜å…ˆ)</td>
</tr>
<tr>
<td>Serial Dispatch Queue (Default Priority)</td>
<td>Concurrent Dispatch Queue</td>
<td>æ‰§è¡Œä¼˜å…ˆçº§ï¼šé»˜è®¤</td>
</tr>
<tr>
<td>Serial Dispatch Queue (Low Priority)</td>
<td>Concurrent Dispatch Queue</td>
<td>æ‰§è¡Œä¼˜å…ˆçº§ï¼šä½</td>
</tr>
<tr>
<td>Serial Dispatch Queue (Background Priority)</td>
<td>Concurrent Dispatch Queue</td>
<td>æ‰§è¡Œä¼˜å…ˆçº§ï¼šåå°</td>
</tr>
</tbody>
</table>
<p><strong>ä½¿ç”¨ä¸¾ä¾‹</strong></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åœ¨é»˜è®¤ä¼˜å…ˆçº§çš„ Global Dispatch Queue ä¸­æ‰§è¡Œblock</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     *å¯å¹¶è¡Œæ‰§è¡Œçš„å¤„ç†</span><br><span class="line">     */</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     *åœ¨ Main Dispatch Queue ä¸­æ‰§è¡Œ block</span><br><span class="line">     */</span></span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue, ^&#123;</span><br><span class="line">        <span class="comment">/*</span><br><span class="line">         *åªèƒ½åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œçš„å¤„ç†</span><br><span class="line">         */</span></span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<hr>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Test]]></title>
      <url>http://raykle.coding.me/2016/07/12/Test/</url>
      <content type="html"><![CDATA[<h1 id="This-is-title"><a href="#This-is-title" class="headerlink" title="This is title"></a>This is title</h1><p>Hello, this is a <code>test</code> post. </p>
<blockquote>
<p>Life is like a box of chocolates, you never know what youâ€™re going to get.</p>
</blockquote>
<p><em>this is code block</em><br><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">"Hello Swift."</span>)</span><br></pre></td></tr></table></figure></p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Hello World]]></title>
      <url>http://raykle.coding.me/2016/05/31/hello-world/</url>
      <content type="html"><![CDATA[<p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<a id="more"></a>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>
]]></content>
    </entry>
    
  
  
</search>
